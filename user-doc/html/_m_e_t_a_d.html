<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>PLUMED: METAD</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.4.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_m_e_t_a_d.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">METAD </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><table align="center" frame="void" width="95%%" celpadding="5%%">
<tr>
<td width="70%%"></td><td><b> This is part of the bias <a class="el" href="mymodules.html">module </a></b>   </td></tr>
</table>
<p>Used to performed MetaDynamics on one or more collective variables.</p>
<p>In a metadynamics simulations a history dependent bias composed of intermittently added Gaussian functions is added to the potential <a class="el" href="citelist.html#CITEREF_metad">[57]</a>.</p>
<p class="formulaDsp">
\[ V(\vec{s},t) = \sum_{ k \tau &lt; t} W(k \tau) \exp\left( -\sum_{i=1}^{d} \frac{(s_i-s_i^{(0)}(k \tau))^2}{2\sigma_i^2} \right). \]
</p>
<p>This potential forces the system away from the kinetic traps in the potential energy surface and out into the unexplored parts of the energy landscape. Information on the Gaussian functions from which this potential is composed is output to a file called HILLS, which is used both the restart the calculation and to reconstruct the free energy as a function of the CVs. The free energy can be reconstructed from a metadynamics calculation because the final bias is given by:</p>
<p class="formulaDsp">
\[ V(\vec{s}) = -F(\vec(s)) \]
</p>
<p>During post processing the free energy can be calculated in this way using the <a class="el" href="sum_hills.html">sum_hills</a> utility.</p>
<p>In the simplest possible implementation of a metadynamics calculation the expense of a metadynamics calculation increases with the length of the simulation as one has to, at every step, evaluate the values of a larger and larger number of Gaussians. To avoid this issue you can store the bias on a grid. This approach is similar to that proposed in <a class="el" href="citelist.html#CITEREF_babi08jcp">[4]</a> but has the advantage that the grid spacing is independent on the Gaussian width. Notice that you should provide either the number of bins for every collective variable (GRID_BIN) or the desired grid spacing (GRID_SPACING). In case you provide both PLUMED will use the most conservative choice (highest number of bins) for each dimension. In case you do not provide any information about bin size (neither GRID_BIN nor GRID_SPACING) and if Gaussian width is fixed PLUMED will use 1/5 of the Gaussian width as grid spacing. This default choice should be reasonable for most applications.</p>
<p>Metadynamics can be restarted either from a HILLS file as well as from a GRID, in this second case one can first save a GRID using GRID_WFILE (and GRID_WSTRIDE) and at a later stage read it using GRID_RFILE.</p>
<p>Another option that is available in plumed is well-tempered metadynamics <a class="el" href="citelist.html#CITEREF_Barducci:2008">[7]</a>. In this varient of metadynamics the heights of the Gaussian hills are rescaled at each step so the bias is now given by:</p>
<p class="formulaDsp">
\[ V({s},t)= \sum_{t&#39;=0,\tau_G,2\tau_G,\dots}^{t&#39;&lt;t} W e^{-V({s}({q}(t&#39;),t&#39;)/\Delta T} \exp\left( -\sum_{i=1}^{d} \frac{(s_i({q})-s_i({q}(t&#39;))^2}{2\sigma_i^2} \right), \]
</p>
<p>This method ensures that the bias converges more smoothly. It should be noted that, in the case of well-tempered metadynamics, in the output printed the Gaussian height is re-scaled using the bias factor. Also notice that with well-tempered metadynamics the HILLS file does not contain the bias, but the negative of the free-energy estimate. This choice has the advantage that one can restart a simulation using a different value for the \(\Delta T\). The applied bias will be scaled accordingly.</p>
<p>Note that you can use here also the flexible gaussian approach <a class="el" href="citelist.html#CITEREF_Branduardi:2012dl">[22]</a> in which you can adapt the gaussian to the extent of Cartesian space covered by a variable or to the space in collective variable covered in a given time. In this case the width of the deposited gaussian potential is denoted by one value only that is a Cartesian space (ADAPTIVE=GEOM) or a time (ADAPTIVE=DIFF). Note that a specific integration technique for the deposited gaussians should be used in this case. Check the documentation for utility sum_hills.</p>
<p>With the keyword INTERVAL one changes the metadynamics algorithm setting the bias force equal to zero outside boundary <a class="el" href="citelist.html#CITEREF_baftizadeh2012protein">[6]</a>. If, for example, metadynamics is performed on a CV s and one is interested only to the free energy for s &gt; sw, the history dependent potential is still updated according to the above equations but the metadynamics force is set to zero for s &lt; sw. Notice that Gaussians are added also if s &lt; sw, as the tails of these Gaussians influence VG in the relevant region s &gt; sw. In this way, the force on the system in the region s &gt; sw comes from both metadynamics and the force field, in the region s &lt; sw only from the latter. This approach allows obtaining a history-dependent bias potential VG that fluctuates around a stable estimator, equal to the negative of the free energy far enough from the boundaries. Note that:</p><ul>
<li>It works only for one-dimensional biases;</li>
<li>It works both with and without GRID;</li>
<li>The interval limit sw in a region where the free energy derivative is not large;</li>
<li>If in the region outside the limit sw the system has a free energy minimum, the INTERVAL keyword should be used together with a <a class="el" href="_u_p_p_e_r__w_a_l_l_s.html">UPPER_WALLS</a> or <a class="el" href="_l_o_w_e_r__w_a_l_l_s.html">LOWER_WALLS</a> at sw.</li>
</ul>
<p>As a final note, since version 2.0.2 when the system is outside of the selected interval the force is set to zero and the bias value to the value at the corresponding boundary. This allows acceptances for replica exchange methods to be computed correctly.</p>
<p>Multiple walkers <a class="el" href="citelist.html#CITEREF_multiplewalkers">[75]</a> can also be used. See below the examples.</p>
<p>The c(t) reweighting factor can also be calculated on the fly using the equations presented in <a class="el" href="citelist.html#CITEREF_Tiwary_jp504920s">[85]</a>. The expression used to calculate c(t) follows directly from using Eq. 12 in Eq. 3 in <a class="el" href="citelist.html#CITEREF_Tiwary_jp504920s">[85]</a> and gives smoother results than equivalent Eqs. 13 and Eqs. 14 in that paper. The c(t) is given by the rct component while the bias normalized by c(t) is given by the rbias component (rbias=bias-ct) which can be used to obtain a reweighted histogram. The calculation of c(t) is enabled by using the keyword REWEIGHTING_NGRID where the grid used for the calculation is specified. This grid should have a size that is equal or larger than the grid given in GRID_BIN./ By default c(t) is updated every 50 Gaussian hills but this can be changed by using the REWEIGHTING_NHILLS keyword. This option can only be employed together with Well-Tempered Metadynamics and requires that a grid is used.</p>
<p>Additional material and examples can be also found in the tutorials:</p>
<ul>
<li><a class="el" href="belfast-6.html">Belfast tutorial: Metadynamics</a></li>
<li><a class="el" href="belfast-7.html">Belfast tutorial: Replica exchange I</a></li>
<li><a class="el" href="belfast-8.html">Belfast tutorial: Replica exchange II and Multiple walkers</a></li>
</ul>
<p>Notice that at variance with PLUMED 1.3 it is now straightforward to apply concurrent metadynamics as done e.g. in Ref. <a class="el" href="citelist.html#CITEREF_gil2015enhanced">[45]</a> . This indeed can be obtained by using the METAD action multiple times in the same input file.</p>
<dl class="section user"><dt>Description of components</dt><dd></dd></dl>
<p>By default this Action calculates the following quantities. These quanties can be referenced elsewhere in the input by using this Action's label followed by a dot and the name of the quantity required from the list below.</p>
<table align="center" frame="void" width="95%%" cellpadding="5%%">
<tr>
<td width="5%"><b> Quantity </b>  </td><td><b> Description </b>   </td></tr>
<tr>
<td width="15%"><b> bias </b> </td><td>the instantaneous value of the bias potential   </td></tr>
<tr>
<td width="15%"><b> work </b> </td><td>accumulator for work   </td></tr>
</table>
<p>In addition the following quantities can be calculated by employing the keywords listed below</p>
<table align="center" frame="void" width="95%%" cellpadding="5%%">
<tr>
<td width="5%"><b> Quantity </b>  </td><td><b> Keyword </b>  </td><td><b> Description </b>   </td></tr>
<tr>
<td width="5%"><b> rbias </b> </td><td width="10%"><b> REWEIGHTING_NGRID </b>  </td><td>the instantaneous value of the bias normalized using the \(c(t)\) reweighting factor [rbias=bias-c(t)].This component can be used to obtain a reweighted histogram.   </td></tr>
<tr>
<td width="5%"><b> rct </b> </td><td width="10%"><b> REWEIGHTING_NGRID </b>  </td><td>the reweighting factor \(c(t)\).   </td></tr>
<tr>
<td width="5%"><b> acc </b> </td><td width="10%"><b> ACCELERATION </b>  </td><td>the metadynamics acceleration factor   </td></tr>
<tr>
<td width="5%"><b> maxbias </b> </td><td width="10%"><b> CALC_MAX_BIAS </b>  </td><td>the maximum of the metadynamics V(s, t)   </td></tr>
<tr>
<td width="5%"><b> transbias </b> </td><td width="10%"><b> CALC_TRANSITION_BIAS </b>  </td><td>the metadynamics transition bias V*(t)   </td></tr>
</table>
<dl class="section user"><dt>Compulsory keywords</dt><dd></dd></dl>
<table align="center" frame="void" width="95%%" cellpadding="5%%">
<tr>
<td width="15%"><b> SIGMA </b> </td><td>the widths of the Gaussian hills   </td></tr>
<tr>
<td width="15%"><b> PACE </b> </td><td>the frequency for hill addition   </td></tr>
<tr>
<td width="15%"><b> FILE </b> </td><td>( default=HILLS ) a file in which the list of added hills is stored   </td></tr>
</table>
<dl class="section user"><dt>Options</dt><dd></dd></dl>
<table align="center" frame="void" width="95%%" cellpadding="5%%">
<tr>
<td width="15%"><b> NUMERICAL_DERIVATIVES </b> </td><td>( default=off ) calculate the derivatives for these quantities numerically   </td></tr>
<tr>
<td width="15%"><b> GRID_SPARSE </b> </td><td>( default=off ) use a sparse grid to store hills   </td></tr>
<tr>
<td width="15%"><b> GRID_NOSPLINE </b> </td><td>( default=off ) don't use spline interpolation with grids   </td></tr>
<tr>
<td width="15%"><b> STORE_GRIDS </b> </td><td>( default=off ) store all the grid files the calculation generates. They will be deleted if this keyword is not present   </td></tr>
<tr>
<td width="15%"><b> WALKERS_MPI </b> </td><td>( default=off ) Switch on MPI version of multiple walkers - not compatible with WALKERS_* options other than WALKERS_DIR   </td></tr>
<tr>
<td width="15%"><b> ACCELERATION </b> </td><td>( default=off ) Set to TRUE if you want to compute the metadynamics acceleration factor.   </td></tr>
<tr>
<td width="15%"><b> CALC_MAX_BIAS </b> </td><td>( default=off ) Set to TRUE if you want to compute the maximum of the metadynamics V(s, t)   </td></tr>
<tr>
<td width="15%"><b> CALC_TRANSITION_BIAS </b> </td><td><p class="starttd">( default=off ) Set to TRUE if you want to compute a metadynamics transition bias V*(t)  </p>
<p class="endtd"></p>
</td></tr>
<tr>
<td width="15%"><b> ARG </b> </td><td>the input for this action is the scalar output from one or more other actions. The particular scalars that you will use are referenced using the label of the action. If the label appears on its own then it is assumed that the Action calculates a single scalar value. The value of this scalar is thus used as the input to this new action. If * or *.* appears the scalars calculated by all the proceding actions in the input file are taken. Some actions have multi-component outputs and each component of the output has a specific label. For example a <a class="el" href="_d_i_s_t_a_n_c_e.html">DISTANCE</a> action labelled dist may have three componets x, y and z. To take just the x component you should use dist.x, if you wish to take all three components then use dist.*.More information on the referencing of Actions can be found in the section of the manual on the PLUMED <a class="el" href="_syntax.html">Getting Started</a>. Scalar values can also be referenced using POSIX regular expressions as detailed in the section on <a class="el" href="_regex.html">Regular Expressions</a>. To use this feature you you must compile PLUMED with the appropriate flag. You can use multiple instances of this keyword i.e. ARG1, ARG2, ARG3...   </td></tr>
<tr>
<td width="15%"><b> HEIGHT </b> </td><td>the heights of the Gaussian hills. Compulsory unless TAU and either BIASFACTOR or DAMPFACTOR are given   </td></tr>
<tr>
<td width="15%"><b> FMT </b> </td><td>specify format for HILLS files (useful for decrease the number of digits in regtests)   </td></tr>
<tr>
<td width="15%"><b> BIASFACTOR </b> </td><td>use well tempered metadynamics and use this biasfactor. Please note you must also specify temp   </td></tr>
<tr>
<td width="15%"><b> RECT </b> </td><td>list of bias factors for all the replicas   </td></tr>
<tr>
<td width="15%"><b> DAMPFACTOR </b> </td><td>damp hills with exp(-max(V)/(kbT*DAMPFACTOR)   </td></tr>
<tr>
<td width="15%"><b> TTBIASFACTOR </b> </td><td>use transition tempered metadynamics with this biasfactor. Please note you must also specify temp   </td></tr>
<tr>
<td width="15%"><b> TTBIASTHRESHOLD </b> </td><td>use transition tempered metadynamics with this bias threshold. Please note you must also specify TTBIASFACTOR   </td></tr>
<tr>
<td width="15%"><b> TTALPHA </b> </td><td>use transition tempered metadynamics with this hill size decay exponent parameter. Please note you must also specify TTBIASFACTOR   </td></tr>
<tr>
<td width="15%"><b> TARGET </b> </td><td>target to a predefined distribution   </td></tr>
<tr>
<td width="15%"><b> TEMP </b> </td><td>the system temperature - this is only needed if you are doing well-tempered metadynamics   </td></tr>
<tr>
<td width="15%"><b> TAU </b> </td><td>in well tempered metadynamics, sets height to (kb*DeltaT*pace*timestep)/tau   </td></tr>
<tr>
<td width="15%"><b> GRID_MIN </b> </td><td>the lower bounds for the grid   </td></tr>
<tr>
<td width="15%"><b> GRID_MAX </b> </td><td>the upper bounds for the grid   </td></tr>
<tr>
<td width="15%"><b> GRID_BIN </b> </td><td>the number of bins for the grid   </td></tr>
<tr>
<td width="15%"><b> GRID_SPACING </b> </td><td>the approximate grid spacing (to be used as an alternative or together with GRID_BIN)   </td></tr>
<tr>
<td width="15%"><b> REWEIGHTING_NGRID </b> </td><td>calculate the c(t) reweighting factor and use that to obtain the normalized bias [rbias=bias-c(t)].Here you should specify the number of grid points required in each dimension.The number of grid points should be equal or larger to the number of grid points given in GRID_BIN.This method is not compatible with metadynamics not on a grid.   </td></tr>
<tr>
<td width="15%"><b> REWEIGHTING_NHILLS </b> </td><td>how many Gaussian hills should be deposited between calculating the c(t) reweighting factor.The default is to do this every 50 hills.   </td></tr>
<tr>
<td width="15%"><b> GRID_WSTRIDE </b> </td><td>write the grid to a file every N steps   </td></tr>
<tr>
<td width="15%"><b> GRID_WFILE </b> </td><td>the file on which to write the grid   </td></tr>
<tr>
<td width="15%"><b> GRID_RFILE </b> </td><td>a grid file from which the bias should be read at the initial step of the simulation   </td></tr>
<tr>
<td width="15%"><b> ADAPTIVE </b> </td><td>use a geometric (=GEOM) or diffusion (=DIFF) based hills width scheme. Sigma is one number that has distance units or timestep dimensions   </td></tr>
<tr>
<td width="15%"><b> WALKERS_ID </b> </td><td>walker id   </td></tr>
<tr>
<td width="15%"><b> WALKERS_N </b> </td><td>number of walkers   </td></tr>
<tr>
<td width="15%"><b> WALKERS_DIR </b> </td><td>shared directory with the hills files from all the walkers   </td></tr>
<tr>
<td width="15%"><b> WALKERS_RSTRIDE </b> </td><td>stride for reading hills files   </td></tr>
<tr>
<td width="15%"><b> INTERVAL </b> </td><td>monodimensional lower and upper limits, outside the limits the system will not feel the biasing force.   </td></tr>
<tr>
<td width="15%"><b> SIGMA_MAX </b> </td><td>the upper bounds for the sigmas (in CV units) when using adaptive hills. Negative number means no bounds   </td></tr>
<tr>
<td width="15%"><b> SIGMA_MIN </b> </td><td>the lower bounds for the sigmas (in CV units) when using adaptive hills. Negative number means no bounds   </td></tr>
<tr>
<td width="15%"><b> ACCELERATION_RFILE </b> </td><td>a data file from which the acceleration should be read at the initial step of the simulation   </td></tr>
<tr>
<td width="15%"><b> TRANSITIONWELL </b> </td><td>This keyword appears multiple times as TRANSITIONWELLx with x=0,1,2,...,n. Each specifies the coordinates for one well as in transition-tempered metadynamics. At least one must be provided. You can use multiple instances of this keyword i.e. TRANSITIONWELL1, TRANSITIONWELL2, TRANSITIONWELL3...   </td></tr>
<tr>
<td width="15%"><b> RESTART </b> </td><td>allows per-action setting of restart (YES/NO/AUTO)   </td></tr>
<tr>
<td width="15%"><b> UPDATE_FROM </b> </td><td>Only update this action from this time   </td></tr>
<tr>
<td width="15%"><b> UPDATE_UNTIL </b> </td><td><p class="starttd">Only update this action until this time  </p>
<p class="endtd"></p>
</td></tr>
</table>
<dl class="section user"><dt>Examples</dt><dd></dd></dl>
<p>The following input is for a standard metadynamics calculation using as collective variables the distance between atoms 3 and 5 and the distance between atoms 2 and 4. The value of the CVs and the metadynamics bias potential are written to the COLVAR file every 100 steps. </p><pre class="fragment">
<a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=3,5 LABEL=d1
<a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=2,4 LABEL=d2
<a href="./_m_e_t_a_d.html" style="color:green">METAD</a> ARG=d1,d2 SIGMA=0.2,0.2 HEIGHT=0.3 PACE=500 LABEL=restraint
<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=d1,d2,restraint.bias STRIDE=100  FILE=COLVAR
</pre><p> (See also <a class="el" href="_d_i_s_t_a_n_c_e.html">DISTANCE</a> <a class="el" href="_p_r_i_n_t.html">PRINT</a>).</p>
<dl class="section user"><dt></dt><dd>If you use adaptive Gaussians, with diffusion scheme where you use a Gaussian that should cover the space of 20 timesteps in collective variables. Note that in this case the histogram correction is needed when summing up hills. <pre class="fragment">
<a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=3,5 LABEL=d1
<a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=2,4 LABEL=d2
<a href="./_m_e_t_a_d.html" style="color:green">METAD</a> ARG=d1,d2 SIGMA=20 HEIGHT=0.3 PACE=500 LABEL=restraint ADAPTIVE=DIFF
<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=d1,d2,restraint.bias STRIDE=100  FILE=COLVAR
</pre></dd></dl>
<dl class="section user"><dt></dt><dd>If you use adaptive Gaussians, with geometrical scheme where you use a Gaussian that should cover the space of 0.05 nm in Cartesian space. Note that in this case the histogram correction is needed when summing up hills. <pre class="fragment">
<a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=3,5 LABEL=d1
<a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=2,4 LABEL=d2
<a href="./_m_e_t_a_d.html" style="color:green">METAD</a> ARG=d1,d2 SIGMA=0.05 HEIGHT=0.3 PACE=500 LABEL=restraint ADAPTIVE=GEOM
<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=d1,d2,restraint.bias STRIDE=100  FILE=COLVAR
</pre></dd></dl>
<dl class="section user"><dt></dt><dd>When using adaptive Gaussians you might want to limit how the hills width can change. You can use SIGMA_MIN and SIGMA_MAX keywords. The sigmas should specified in terms of CV so you should use the CV units. Note that if you use a negative number, this means that the limit is not set. Note also that in this case the histogram correction is needed when summing up hills. <pre class="fragment">
<a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=3,5 LABEL=d1
<a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=2,4 LABEL=d2
<a href="./_m_e_t_a_d.html" style="color:green">METAD</a> ...
  ARG=d1,d2 SIGMA=0.05 HEIGHT=0.3 PACE=500 LABEL=restraint ADAPTIVE=GEOM
  SIGMA_MIN=0.2,0.1 SIGMA_MAX=0.5,1.0
... METAD
<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=d1,d2,restraint.bias STRIDE=100  FILE=COLVAR
</pre></dd></dl>
<dl class="section user"><dt></dt><dd>Multiple walkers can be also use as in <a class="el" href="citelist.html#CITEREF_multiplewalkers">[75]</a> These are enabled by setting the number of walker used, the id of the current walker which interprets the input file, the directory where the hills containing files resides, and the frequency to read the other walkers. Here is an example <pre class="fragment">
<a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=3,5 LABEL=d1
<a href="./_m_e_t_a_d.html" style="color:green">METAD</a> ...
   ARG=d1 SIGMA=0.05 HEIGHT=0.3 PACE=500 LABEL=restraint
   WALKERS_N=10
   WALKERS_ID=3
   WALKERS_DIR=../
   WALKERS_RSTRIDE=100
... METAD
</pre> where WALKERS_N is the total number of walkers, WALKERS_ID is the id of the present walker (starting from 0 ) and the WALKERS_DIR is the directory where all the walkers are located. WALKERS_RSTRIDE is the number of step between one update and the other. Since version 2.2.5, hills files are automatically flushed every WALKERS_RSTRIDE steps.</dd></dl>
<dl class="section user"><dt></dt><dd>The c(t) reweighting factor can be calculated on the fly using the equations presented in <a class="el" href="citelist.html#CITEREF_Tiwary_jp504920s">[85]</a> as described above. This is enabled by using the keyword REWEIGHTING_NGRID where the grid used for the calculation is set. The number of grid points given in REWEIGHTING_NGRID should be equal or larger than the number of grid points given in GRID_BIN. <pre class="fragment">
<a href="./_m_e_t_a_d.html" style="color:green">METAD</a> ...
 LABEL=metad
 ARG=phi,psi SIGMA=0.20,0.20 HEIGHT=1.20 BIASFACTOR=5 TEMP=300.0 PACE=500
 GRID_MIN=-pi,-pi GRID_MAX=pi,pi GRID_BIN=150,150
 REWEIGHTING_NGRID=150,150
 REWEIGHTING_NHILLS=20
... METAD
</pre> Here we have asked that the calculation is performed every 20 hills by using REWEIGHTING_NHILLS keyword. If this keyword is not given the calculation will by default be performed every 50 hills. The c(t) reweighting factor will be given in the rct component while the instantaneous value of the bias potential normalized using the c(t) reweighting factor is given in the rbias component [rbias=bias-c(t)] which can be used to obtain a reweighted histogram or free energy surface using the <a class="el" href="_h_i_s_t_o_g_r_a_m.html">HISTOGRAM</a> analysis.</dd></dl>
<dl class="section user"><dt></dt><dd>The kinetics of the transitions between basins can also be analysed on the fly as in <a class="el" href="citelist.html#CITEREF_PRL230602">[84]</a>. The flag ACCELERATION turn on accumulation of the acceleration factor that can then be used to determine the rate. This method can be used together with <a class="el" href="_c_o_m_m_i_t_t_o_r.html">COMMITTOR</a> analysis to stop the simulation when the system get to the target basin. It must be used together with Well-Tempered Metadynamics.</dd></dl>
<dl class="section user"><dt></dt><dd>You can also provide a target distribution using the keyword TARGET <a class="el" href="citelist.html#CITEREF_white2015designing">[96]</a> <a class="el" href="citelist.html#CITEREF_marinelli2015ensemble">[65]</a> <a class="el" href="citelist.html#CITEREF_gil2016empirical">[46]</a> The TARGET should be a grid containing a free-energy (i.e. the -kbT*log of the desired target distribution). Gaussians will then be scaled by a factor <p class="formulaDsp">
\[ e^{\beta(\tilde{F}(s)-\tilde{F}_{max})} \]
</p>
 Here \(\tilde{F}(s)\) is the free energy defined on the grid and \(\tilde{F}_{max}\) its maximum value. Notice that we here used the maximum value as in ref <a class="el" href="citelist.html#CITEREF_gil2016empirical">[46]</a> This choice allows to avoid exceedingly large Gaussians to be added. However, it could make the Gaussian too small. You should always choose carefully the HEIGHT parameter in this case. The grid file should be similar to other PLUMED grid files in that it should contain both the target free-energy and its derivatives.</dd></dl>
<p>Notice that if you wish your simulation to converge to the target free energy you should use the DAMPFACTOR command to provide a global tempering <a class="el" href="citelist.html#CITEREF_dama2014well">[37]</a> Alternatively, if you use a BIASFACTOR yout simulation will converge to a free energy that is a linear combination of the target free energy and of the intrinsic free energy determined by the original force field.</p>
<pre class="fragment">
<a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=3,5 LABEL=d1
<a href="./_m_e_t_a_d.html" style="color:green">METAD</a> ...
 LABEL=t1
 ARG=d1 SIGMA=0.05 TAU=200 DAMPFACTOR=100 PACE=250
 GRID_MIN=0 GRID_MAX=2 GRID_BIN=200
 TARGET=dist.dat
... METAD

<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=d1,t1.bias STRIDE=100 FILE=COLVAR
</pre><p>The header in the file dist.dat for this calculation would read:</p>
<pre class="fragment">#! FIELDS d1 t1.target der_d1
#! SET min_d1 0
#! SET max_d1 2
#! SET nbins_d1  200
#! SET periodic_d1 false
</pre><p>Notice that BIASFACTOR can also be chosen as equal to 1. In this case one will perform unbiased sampling. Instead of using HEIGHT, one should provide the TAU parameter. </p><pre class="fragment">
d: <a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=3,5
<a href="./_m_e_t_a_d.html" style="color:green">METAD</a> ARG=d SIGMA=0.1 TAU=4.0 TEMP=300 PACE=100 BIASFACTOR=1.0
</pre><p> The HILLS file obtained will still work with <code>plumed sum_hills</code> so as to plot a free-energy. The case where this makes sense is probably that of RECT simulations.</p>
<p>Regarding RECT simulations, you can also use the RECT keyword so as to avoid using multiple input files. For instance, a single input file will be </p><pre class="fragment">
d: <a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=3,5
<a href="./_m_e_t_a_d.html" style="color:green">METAD</a> ARG=d SIGMA=0.1 TAU=4.0 TEMP=300 PACE=100 RECT=1.0,1.5,2.0,3.0
</pre><p> The number of elements in the RECT array should be equal to the number of replicas. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="_bias.html">Bias</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
