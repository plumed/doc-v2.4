<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>PLUMED: Trieste tutorial: Analyzing trajectories using PLUMED</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.4.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('trieste-1.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Trieste tutorial: Analyzing trajectories using PLUMED </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="trieste-1-aims"></a>
Aims</h1>
<p>The aim of this tutorial is to introduce the users to the PLUMED syntax. We will go through the writing of simple collective variable and we will use them to analyze existing trajectories.</p>
<h1><a class="anchor" id="trieste-1-objectives"></a>
Objectives</h1>
<p>Once this tutorial is completed students will be able to:</p>
<ul>
<li>Write a simple PLUMED input file and use it with the PLUMED <a class="el" href="driver.html">driver</a> to analyse a trajectory.</li>
<li>Use the <a class="el" href="_g_r_o_u_p.html">GROUP</a> keyword to make the input file compact and easy to read and to quickly build complex atom groups.</li>
<li>Print collective variables such as distances (<a class="el" href="_d_i_s_t_a_n_c_e.html">DISTANCE</a>), torsional angles (<a class="el" href="_t_o_r_s_i_o_n.html">TORSION</a>), gyration radius (<a class="el" href="_g_y_r_a_t_i_o_n.html">GYRATION</a>), and coordination numbers (<a class="el" href="_c_o_o_r_d_i_n_a_t_i_o_n.html">COORDINATION</a>) using the <a class="el" href="_p_r_i_n_t.html">PRINT</a> action.</li>
<li>Computing the geometric center of a group of atoms using <a class="el" href="_c_e_n_t_e_r.html">CENTER</a>.</li>
<li>Know how to take care of periodic boundary conditions within PLUMED using <a class="el" href="_w_h_o_l_e_m_o_l_e_c_u_l_e_s.html">WHOLEMOLECULES</a> and <a class="el" href="_w_r_a_p_a_r_o_u_n_d.html">WRAPAROUND</a>, and be able to verify the result with <a class="el" href="_d_u_m_p_a_t_o_m_s.html">DUMPATOMS</a>.</li>
<li>Extract from a trajectory snapshots satisfying specific conditions using <a class="el" href="_u_p_d_a_t_e__i_f.html">UPDATE_IF</a>.</li>
</ul>
<h1><a class="anchor" id="trieste-1-resources"></a>
Resources</h1>
<p>The <span style="background-color:yellow"><a href="tutorial-resources/trieste-1.tar.gz" style="font-weight:bold" style="color:green" download="trieste-1.tar.gz">TARBALL </a> </span> for this project contains the following files:</p><ul>
<li>ref.pdb : A PDB file with a RNA duplex solvated in a water box and a Mg ion.</li>
<li>traj-whole.xtc: A trajectory for the same system in GROMACS xtc format. To make the exercise easier, RNA duplex has been made whole already.</li>
<li>traj-broken.xtc: The same trajectory as it was originally produced by GROMACS. Here the RNA duplex is broken and should be fixed.</li>
</ul>
<p>This tutorial has been tested on a pre-release version of version 2.4. However, it should not take advantage of 2.4-only features, thus should also work with version 2.3.</p>
<p>Also notice that in the <code>.solutions</code> directory of the tarball you will find correct input files. Please only look at these files after you have tried to solve the problems yourself.</p>
<h1><a class="anchor" id="trieste-1-intro"></a>
Introduction</h1>
<p>This tutorial asks you to compute a variety of different collective variables using PLUMED for a particular trajectory and to compare the files and graphs that you obtain with the correct ones that are shown online. Compared to some of the other tutorials that are available here this tutorial contains considerably less guidance so in doing this tutorial you will have to learn how to consult the manual. If you would like a more guided introduction to PLUMED it might be better to start with the tutorials <a class="el" href="belfast-1.html">Belfast tutorial: Analyzing CVs</a> or <a class="el" href="lugano-1.html">Lugano tutorial: Analyzing CVs</a>. <br />
Also notice that, whereas this tutorial was tested using a pre-release version of PLUMED 2.4, it should be completely feasible using PLUMED 2.3.</p>
<h1><a class="anchor" id="trieste-1-cl"></a>
Using PLUMED from the command line</h1>
<p>As we will see later, PLUMED provides a library that can be combined with multiple MD codes. However, in this tutorial we will only use PLUMED to analyze trajectories that have been produced already. Once PLUMED is installed you can run a <code>plumed</code> executable that can be used for multiple purposes:</p>
<pre class="fragment">&gt; plumed --help 
</pre><p>Here we will use the <a class="el" href="driver.html">driver</a> tool, that allows you to process an already existing trajectory.</p>
<pre class="fragment">&gt; plumed driver --help
</pre><p>What we will need is:</p><ul>
<li>A trajectory to be analyzed (provided).</li>
<li>A PLUMED input file (you do it!).</li>
</ul>
<p>The syntax of the PLUMED input file is the same that we will use later to run enhanced sampling simulations, so all the things that you will learn now will be useful later when you will run PLUMED coupled to an MD code. In the following we are going to see how to write an input file for PLUMED.</p>
<h1><a class="anchor" id="trieste-1-structure"></a>
The structure of a PLUMED input file</h1>
<p>The main goal of PLUMED is to compute collective variables, which are complex descriptors than can be used to analyze a conformational change or a chemical reaction. This can be done either on the fly, that is during molecular dynamics, or a posteriori, using PLUMED as a post-processing tool. In both cases one should create an input file with a specific PLUMED syntax. A sample input file is below:</p>
<pre class="fragment">
<span style="color:blue"># this is optional and tell to VIM that this is a PLUMED file</span>
<span style="color:blue"># vim: ft=plumed</span>
<span style="color:blue"># see comments just below this input file</span>

<span style="color:blue"># Compute distance between atoms 1 and 10.</span>
<span style="color:blue"># Atoms are ordered as in the trajectory files and their numbering starts from 1.</span>
<span style="color:blue"># The distance is called "d" for future reference.</span>
d: <a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=1,10

<span style="color:blue"># Create a virtual atom in the center between atoms 20 and 30.</span>
<span style="color:blue"># The virtual atom only exists within PLUMED and is called "center" for future reference.</span>
center: <a href="./_c_e_n_t_e_r.html" style="color:green">CENTER</a> ATOMS=20,30

<span style="color:blue"># Compute the torsional angle between atoms 1, 10, 20, and center.</span>
<span style="color:blue"># Notice that virtual atoms can be used as real atoms here.</span>
<span style="color:blue"># The angle is called "phi" for future reference.</span>
phi: <a href="./_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> ATOMS=1,10,20,center

<span style="color:blue"># Compute some function of previously computed variables.</span>
<span style="color:blue"># In this case we compute the cosine of angle phi and we call it "d2"</span>
d2: <a href="./_m_a_t_h_e_v_a_l.html" style="color:green">MATHEVAL</a> ...
  ARG=phi FUNC=cos(x)
  PERIODIC=NO
...
<span style="color:blue"># The previous command has been split in multiple lines.</span>
<span style="color:blue"># It could have been equivalently written in a single line:</span>
<span style="color:blue">#   d2: MATHEVAL ARG=phi FUNC=cos(x) PERIODIC=NO</span>

<span style="color:blue"># Print d and d2 every 10 step on a file named "COLVAR1".</span>
<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=d,d2 STRIDE=10 FILE=COLVAR1

<span style="color:blue"># Print phi on another file names "COLVAR2" every 100 steps.</span>
<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=phi STRIDE=100 FILE=COLVAR2
</pre><dl class="section note"><dt>Note</dt><dd>If you are a VIM user, you might find convenient configuring PLUMED syntax files, see <a class="el" href="_vim_syntax.html">Using VIM syntax file</a>. Syntax highlighting is particularly useful for beginners since it allows you to identify simple mistakes without the need to run PLUMED. In addition, VIM has a full dictionary of available keywords and can help you autocompleting your commands.</dd></dl>
<p>In the input file above, each line defines a so-called action. An action could either compute a distance, or the center between two or more atoms, or print some value on a file. Each action supports a number of keywords, whose value is specified. Action names are highlighted in green and, clicking on them, you can go to the corresponding page in the manual that contains a detailed description for each keyword. Actions that support the keyword <code>STRIDE</code> are those that determine how frequently things are to be done. Notice that the default value for <code>STRIDE</code> is always 1. In the example above, omitting <code>STRIDE</code> keywords the corresponding COLVAR files would have been written for every frame of the analyzed trajectory. All the other actions in the example above do not support the <code>STRIDE</code> keyword and are only calculated when requested. That is, <code>d</code> and <code>d2</code> will be computed every 10 frames, and <code>phi</code> every 100 frames. In short, you can think that for every snapshot in the trajectory that you are analyzing PLUMED is going to execute all the listed actions, though some of them are optimized out when <code>STRIDE</code> is different from 1.</p>
<p>Also notice that PLUMED works using kJ/nm/ps as energy/length/time units. This can be personalized using <a class="el" href="_u_n_i_t_s.html">UNITS</a>, but we will here stay with default values.</p>
<p>Variables should be given a name (in the example above, <code>d</code>, <code>phi</code>, and <code>d2</code>), which is then used to refer to these variables. Instead of <code>a: DISTANCE ATOMS=1,2</code> you might equivalently use <code>DISTANCE ATOMS=1,2 LABEL=a</code>. Lists of atoms should be provided as comma separated numbers, with no space. Virtual atoms can be created and assigned a name for later use.</p>
<p>You can find more information on the PLUMED syntax at <a class="el" href="_syntax.html">Getting Started</a> page of the manual. The complete documentation for all the supported collective variables can be found at the <a class="el" href="colvarintro.html">Collective Variables</a> page.</p>
<p>To analyze the trajectory provided here, you should:</p><ul>
<li>Create a PLUMED input file with a text editor (let us call it <code>plumed.dat</code>) similar to the one above.</li>
<li>Run the command <code>plumed driver --mf_xtc traj.xtc --plumed plumed.dat</code>.</li>
</ul>
<p>Here <code>traj.xtc</code> is the trajectory that you want to analyze. Notice that <a class="el" href="driver.html">driver</a> can read multiple file formats using embedded molfile plugins from VMD (that's where the <code>mf</code> letters come from).</p>
<p>Notice that you can also visualize trajectories with VMD directly. Trajectory <code>traj.xtc</code> can be visualized with the command <code>vmd ref.pdb traj-whole.xtc</code>.</p>
<p>In the following we will make practice with computing and printing collective variables.</p>
<h2><a class="anchor" id="trieste-1-ex-1"></a>
Exercise 1: Computing and printing collective variables</h2>
<p>Analyze the <code>traj-whole.xtc</code> trajectory and produce a colvar file with the following collective variables.</p>
<ul>
<li>The gyration radius of the solute RNA molecule (<a class="el" href="_g_y_r_a_t_i_o_n.html">GYRATION</a>). Look in the <code>ref.pdb</code> file which are the atoms that are part of RNA (search for the first occurrence of a water molecule, residue name <code>SOL</code>). Remember that you don't need to list all the atoms: instead of <code>ATOMS=1,2,3,4,5</code> you can write <code>ATOMS=1-5</code>.</li>
<li>The torsional angle (<a class="el" href="_t_o_r_s_i_o_n.html">TORSION</a>) corresponding to the glycosidic chi angle \(\chi\) of the first nucleotide. Since this nucleotide is a purine (guanine), the proper atoms to compute the torsion are O4' C1 N9 C4. Find their serial number in the <code>ref.pdb</code> file or learn how to select a special angle reading the <a class="el" href="_m_o_l_i_n_f_o.html">MOLINFO</a> documentation.</li>
<li>The total number of contacts (<a class="el" href="_c_o_o_r_d_i_n_a_t_i_o_n.html">COORDINATION</a>) between all RNA atoms and all water oxygens. For <a class="el" href="_c_o_o_r_d_i_n_a_t_i_o_n.html">COORDINATION</a>, set reference distance <code>R_0</code> to 2.5 A (be careful with units!!). Try to be smart in selecting the water oxygens without listing all of them explicitly.</li>
<li>Same as before but against water hydrogen. Also in this case you should be smart to select water hydrogens. Documentation of <a class="el" href="_g_r_o_u_p.html">GROUP</a> might help.</li>
<li>Distance between the Mg ion and the geometric center of the RNA duplex (use <a class="el" href="_c_e_n_t_e_r.html">CENTER</a> and <a class="el" href="_d_i_s_t_a_n_c_e.html">DISTANCE</a>).</li>
</ul>
<p>Notice that some of the atom selections can be made in a easier manner by using the <a class="el" href="_m_o_l_i_n_f_o.html">MOLINFO</a> keyword with a proper reference PDB file. Also read carefully the <a class="el" href="_group.html">Groups and Virtual Atoms</a> page before starting. Here you can find a sample <code>plumed.dat</code> file that you can use as a template. Whenever you see an highlighted <span style="background-color:yellow">FILL</span> string, this is a string that you should replace.</p>
<pre class="fragment">
<span style="color:blue"># First load information about the molecule.</span>
<a href="./_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <span style="background-color:yellow">__FILL__</span>
<span style="color:blue"># Notice that this is special kind of "action" ("setup action")</span>
<span style="color:blue"># that is only used during setup. It will not be re-executed at each step.</span>

<span style="color:blue"># Define some group that will make the rest of the input more readable</span>
<span style="color:blue"># Here are the atoms belonging to RNA.</span>
rna: <a href="./_g_r_o_u_p.html" style="color:green">GROUP</a> ATOMS=1-258
<span style="color:blue"># This is the Mg ion. A group with atom is also useful!</span>
mg:  <a href="./_g_r_o_u_p.html" style="color:green">GROUP</a> ATOMS=6580
<span style="color:blue"># This group should contain all the atoms belonging to water molecules.</span>
wat: <a href="./_g_r_o_u_p.html" style="color:green">GROUP</a> ATOMS=<span style="background-color:yellow">__FILL__</span>
<span style="color:blue"># Select water oxygens only:</span>
owat: <a href="./_g_r_o_u_p.html" style="color:green">GROUP</a> <span style="background-color:yellow">__FILL__</span>
<span style="color:blue"># Select water hydrogens only:</span>
hwat: <a href="./_g_r_o_u_p.html" style="color:green">GROUP</a> <span style="background-color:yellow">__FILL__</span>

<span style="color:blue"># Compute gyration radius:</span>
r: <a href="./_g_y_r_a_t_i_o_n.html" style="color:green">GYRATION</a> ATOMS=<span style="background-color:yellow">__FILL__</span>
<span style="color:blue"># Compute the Chi torsional angle:</span>
c: <a href="./_t_o_r_s_i_o_n.html" style="color:green">TORSION</a> ATOMS=<span style="background-color:yellow">__FILL__</span>
<span style="color:blue"># Compute coordination of RNA with water oxygens</span>
co: <a href="./_c_o_o_r_d_i_n_a_t_i_o_n.html" style="color:green">COORDINATION</a> GROUPA=rna GROUPB=owat R_0=<span style="background-color:yellow">__FILL__</span>
<span style="color:blue"># Compute coordination of RNA with water hydrogens</span>
ch: <a href="./_c_o_o_r_d_i_n_a_t_i_o_n.html" style="color:green">COORDINATION</a> GROUPA=rna GROUPB=hwat <span style="background-color:yellow">__FILL__</span>

<span style="color:blue"># Compute the geometric center of the RNA molecule:</span>
ce: <a href="./_c_e_n_t_e_r.html" style="color:green">CENTER</a> ATOMS=<span style="background-color:yellow">__FILL__</span>
<span style="color:blue"># Compute the distance between the Mg ion and the RNA center:</span>
d: <a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=<span style="background-color:yellow">__FILL__</span>

<span style="color:blue"># Print the collective variables on COLVAR file</span>
<span style="color:blue"># No STRIDE means "print for every step"</span>
<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=r,c,co,ch,d FILE=COLVAR
</pre><p>Once your <code>plumed.dat</code> file is complete, you can use it with the following command </p><pre class="fragment">&gt; plumed driver --plumed plumed.dat --mf_xtc whole.xtc
</pre><p>Scroll in your terminal to read the PLUMED log. As you can see, PLUMED gives a lot of feedbacks about the input that he is reading. There's the place where you can check if PLUMED understood correctly your input.</p>
<p>The command above will create a file <code>COLVAR</code> like this one: </p><pre class="fragment">#! FIELDS time r c co ch d
#! SET min_c -pi
#! SET max_c pi
 0.000000 0.788694 -2.963150 207.795793 502.027244 0.595611
 1.000000 0.804101 -2.717302 208.021688 499.792595 0.951945
 2.000000 0.788769 -2.939333 208.347867 500.552127 1.014850
 3.000000 0.790232 -2.940726 211.274315 514.749124 1.249502
 4.000000 0.796395 3.050949 212.352810 507.892198 2.270682
</pre><p> Notice that the first line informs you about the content of each column and the second and third lines tell you that variable <code>c</code> (the \(\chi\) torsion) is defined between \(-\pi\) and \(+\pi\).</p>
<p><b>In case you obtain different numbers, check your input, you might have made some mistake!</b></p>
<p>This file can then be shown with <code>gnuplot</code> </p><pre class="fragment">gnuplot&gt; p "COLVAR" u 1:2, "" u 1:3
</pre><p>As a final note, look at what happens if you run the exercise twice. The second time, PLUMED will <em>back up</em> the previously produced file so as not to overwrite it. You can also <em>concatenate</em> your files by using the action <a class="el" href="_r_e_s_t_a_r_t.html">RESTART</a> at the beginning of your input file.</p>
<p> <details> <summary> <b> To learn more: Combining collective variables </b> </summary> <div class="hidden"> </p>
<p>In this first exercise we only computed simple functions of the atomic coordinates. PLUMED is very flexible and allows you to also combine these functions to create more complicated variables. These variables can be useful when you want to describe a complex conformational change. PLUMED implements a number of functions that can be used to this aim that are described in the page <a class="el" href="_function.html">Functions</a>. Look at the following example: </p><pre class="fragment">
<span style="color:blue"># Distance between atoms 1 and 2:</span>
d1: <a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=1,2
<span style="color:blue"># Distance between atoms 1 and 3:</span>
d2: <a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=1,3
<span style="color:blue"># Distance between atoms 1 and 4:</span>
d3: <a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=1,4

<span style="color:blue"># Compute the sum of the squares of those three distances:</span>
c: <a href="./_c_o_m_b_i_n_e.html" style="color:green">COMBINE</a> ARG=d1,d2,d3 POWERS=2 PERIODIC=NO

<span style="color:blue"># Sort the three distances:</span>
s: <a href="./_s_o_r_t.html" style="color:green">SORT</a> ARG=d1,d2,d3
<span style="color:blue"># Notice that SORT creates a compund object with three components:</span>
<span style="color:blue"># s.1: the smallest distance</span>
<span style="color:blue"># s.2: the middle distance</span>
<span style="color:blue"># s.3: the largest distance</span>

p: <a href="./_m_a_t_h_e_v_a_l.html" style="color:green">MATHEVAL</a> ARG=d1,d2,d3 FUNC=x*y*z PERIODIC=NO

<span style="color:blue"># Print the sum of the squares and the largest among the three distances:</span>
<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> FILE=COLVAR ARG=c,s.3
</pre><p>In case you have many distances to combine you can also use regular expressions to select them using <code>ARG=(d.)</code>, see <a class="el" href="_regex.html">Regular Expressions</a>.</p>
<p>Notice for many functions you should say to PLUMED if the function is periodic. See <a class="el" href="_function.html">Functions</a> for a detailed explanation of how to choose this keyword.</p>
<p>You might think that it is easier to combine the variables after you have written them already, using, e.g., an awk or python script. That's fine if you are analyzing a trajectory. However, as we will learn later, computing variables within PLUMED you will be able to add bias potentials on those combinations, influencing their dynamics. Actually, you could implement any arbitrarily complex collective variable using just <a class="el" href="_d_i_s_t_a_n_c_e.html">DISTANCE</a> and <a class="el" href="_m_a_t_h_e_v_a_l.html">MATHEVAL</a>! Anyway, if the CV combinations that you are willing to use can be computed easily with some external program, do it and compare the results with the output of the PLUMED driver.</p>
<h2><a class="anchor" id="trieste-1-ex-1b"></a>
Exercise 1b: Combining collective variables</h2>
<p>As an optional exercise, create a file with the following quantities:</p><ul>
<li>The sum of the distances between Mg and each of the phosphorous atoms.</li>
<li>The distance between Mg and the closest phosphorous atom.</li>
</ul>
<p>Notice that the serial numbers of the phosphorous atoms can be easily extracted using the following command </p><pre class="fragment">&gt; grep ATOM ref.pdb | grep " P " | awk '{print $2}'
</pre><p>Here's a template input file to be completed by you. </p><pre class="fragment">
<span style="color:blue"># First load information about the molecule.</span>
<a href="./_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <span style="background-color:yellow">__FILL__</span>

<span style="color:blue"># Define some group that will make the rest of the input more readable</span>
mg:  <a href="./_g_r_o_u_p.html" style="color:green">GROUP</a> ATOMS=6580 <span style="color:blue"># a group with one atom is also useful!</span>

<span style="color:blue"># Distances between Mg and phosphorous atoms:</span>
d1: <a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=mg,33
d2: <a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <span style="background-color:yellow">__FILL__</span>
<span style="background-color:yellow">__FILL__</span>
d6: <a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> <span style="background-color:yellow">__FILL__</span>
<span style="color:blue"># You can use serial numbers, but you might also use MOLINFO strings</span>

<span style="color:blue"># Compute the sum of these distances</span>
c: <a href="./_c_o_m_b_i_n_e.html" style="color:green">COMBINE</a> <span style="background-color:yellow">__FILL__</span>

<span style="color:blue"># Compute the distance between Mg and the closest phosphorous atom</span>
s: <a href="./_s_o_r_t.html" style="color:green">SORT</a> <span style="background-color:yellow">__FILL__</span>

<span style="color:blue"># Print the requested variables</span>
<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> FILE=COLVAR <span style="background-color:yellow">__FILL__</span>
</pre><p>Notice that using the collective variable <a class="el" href="_d_i_s_t_a_n_c_e_s.html">DISTANCES</a> you might be able to do the same with a significantly simpler input file! If you have time, also try that and compare the result.</p>
<p>The resulting <code>COLVAR</code> file should look like this one:</p>
<pre class="fragment">#! FIELDS time c s.1
 0.000000 6.655622 0.768704
 1.000000 7.264049 0.379416
 2.000000 7.876489 0.817820
 3.000000 8.230621 0.380191
 4.000000 13.708759 2.046935
</pre><p> </div> </details> </p>
<h1><a class="anchor" id="trieste-1-pbc"></a>
Solving periodic-boundary conditions issues</h1>
<p>While running PLUMED can also dump the coordinate of the internally stored atoms using <a class="el" href="_d_u_m_p_a_t_o_m_s.html">DUMPATOMS</a>. This might seem useless (coordinates are already contained in the original trajectory) but can be used in the following cases:</p><ul>
<li>To dump coordinates of virtual atoms that only exist within PLUMED (e.g. a <a class="el" href="_c_e_n_t_e_r.html">CENTER</a>).</li>
<li>To dump snapshots of our molecule conditioned to some value of some collective variable (see <a class="el" href="_u_p_d_a_t_e__i_f.html">UPDATE_IF</a>).</li>
<li>To dump coordinates of atoms that have been moved by PLUMED.</li>
</ul>
<p>The last point is perhaps the most surpising one. Some of the PLUMED actions can indeed move the stored atoms to positions better suitable for the calculation of collective variables.</p>
<p>The previous exercise was done on a trajectory where the RNA was already whole. For the next exercise you will use the <code>traj-broken.xtc</code> file instead, which is a real trajectory produced by GROMACS. Open it with VMD to understand what we mean with broken </p><pre class="fragment">&gt; vmd ref.pdb traj-broken.xtc
</pre><p> Select <code>Graphics</code>, then <code>Representations</code>, then type <code>nucleic</code> in the box <code>Selected Atoms</code>. You will see that your RNA duplex is not whole. This is not a problem during MD because of periodic boundary conditions. However, it is difficult to analyze this trajectory. In addition, some collective variables that you might want to compute could require the molecules to be whole (an example of such variables is <a class="el" href="_r_m_s_d.html">RMSD</a>).</p>
<p>You might think that there are alternative programs that can be used to reconstruct PBCs correctly in your trajectory <em>before</em> analyzing it. However, you should keep in mind that if you need to compute CVs on the fly to add a bias potential on those (as we will to in the next tutorials) you will have to learn how to reconstruct PBCs within PLUMED. If you know alternative tools that can reconstruct PBCs, it is a good idea to also use them and compare the result with PLUMED.</p>
<h2><a class="anchor" id="trieste-1-ex-2"></a>
Exercise 2: Solving PBC issues and dump atomic coordinates</h2>
<p>Analyze the provided trajectory <code>traj-broken.xtc</code> and use the <a class="el" href="_d_u_m_p_a_t_o_m_s.html">DUMPATOMS</a> action to produce new trajectories in <code>gro</code> format that contain:</p><ul>
<li>The RNA duplex made whole (not broken by periodic boundary conditions). You should read carefully the documentation of <a class="el" href="_w_h_o_l_e_m_o_l_e_c_u_l_e_s.html">WHOLEMOLECULES</a>.</li>
<li>The whole RNA duplex aligned to a provided template (structure <code>reference.pdb</code>). See <a class="el" href="_f_i_t__t_o__t_e_m_p_l_a_t_e.html">FIT_TO_TEMPLATE</a>, using <code>TYPE=OPTIMAL</code>. Notice that you should provide to <a class="el" href="_f_i_t__t_o__t_e_m_p_l_a_t_e.html">FIT_TO_TEMPLATE</a> a pdb file with only the atoms that you wish to align. Use the <code>ref.pdb</code> file as a starting point and remove the lines non containing RNA atoms. More details on PDB files in PLUMED can be found <a class="el" href="pdbreader.html">here</a>.</li>
<li>The whole RNA duplex and Mg ion, but only including the snapshots where Mg is at a distance equal to at most 4 A from phosphorous atom of residue 8. Search for the serial number of the proper phosphorous atom in the PDB file and use the <a class="el" href="_u_p_d_a_t_e__i_f.html">UPDATE_IF</a> action to select the frames.</li>
<li>The whole RNA duplex plus water molecules and mg ion wrapped around the center of the duplex. Compute first the center of the duplex with <a class="el" href="_c_e_n_t_e_r.html">CENTER</a> then wrap the molecules with <a class="el" href="_w_r_a_p_a_r_o_u_n_d.html">WRAPAROUND</a>. Make sure that individual water molecules are not broken after the move!</li>
</ul>
<p>Here you can find a template input file to be completed by you. </p><pre class="fragment">
<span style="color:blue"># First load information about the molecule.</span>
<a href="./_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <span style="background-color:yellow">__FILL__</span>

<span style="color:blue"># Define here the groups that you need.</span>
<span style="color:blue"># Same as in the previous exercise.</span>
rna: <a href="./_g_r_o_u_p.html" style="color:green">GROUP</a> ATOMS=<span style="background-color:yellow">__FILL__</span>
mg:  <a href="./_g_r_o_u_p.html" style="color:green">GROUP</a> ATOMS=<span style="background-color:yellow">__FILL__</span>
wat: <a href="./_g_r_o_u_p.html" style="color:green">GROUP</a> ATOMS=<span style="background-color:yellow">__FILL__</span>

<span style="color:blue"># Make RNA duplex whole.</span>
<a href="./_w_h_o_l_e_m_o_l_e_c_u_l_e_s.html" style="color:green">WHOLEMOLECULES</a> <span style="background-color:yellow">__FILL__</span>

<span style="color:blue"># Dump first trajectory in gro format.</span>
<span style="color:blue"># Notice that PLUMED understands the format based on the file extension</span>
<a href="./_d_u_m_p_a_t_o_m_s.html" style="color:green">DUMPATOMS</a> ATOMS=rna FILE=rna-whole.gro

<span style="color:blue"># Align RNA duplex to a reference structure</span>
<span style="color:blue"># This should not be the ref.pdb file but a new file with only RNA atoms.</span>
<a href="./_f_i_t__t_o__t_e_m_p_l_a_t_e.html" style="color:green">FIT_TO_TEMPLATE</a> REFERENCE=<span style="background-color:yellow">__FILL__</span> TYPE=OPTIMAL
<span style="color:blue"># Notice that before using FIT_TO_TEMPLATE we used WHOLEMOLECULES to make RNA whole</span>
<span style="color:blue"># This is necessary otherwise you would align a broken molecule!</span>

<span style="color:blue"># Dump the aligned RNA on a separate file</span>
<a href="./_d_u_m_p_a_t_o_m_s.html" style="color:green">DUMPATOMS</a> ATOMS=rna FILE=rna-aligned.gro

<span style="color:blue"># Compute the distance between the Mg and the Phosphorous from residue 8</span>
d: <a href="./_d_i_s_t_a_n_c_e.html" style="color:green">DISTANCE</a> ATOMS=mg,<span style="background-color:yellow">__FILL__</span> <span style="color:blue">## put the serial number of the correct phosphorous here</span>

<span style="color:blue"># here we only dump frames conditioned to the value of d</span>
<a href="./_u_p_d_a_t_e__i_f.html" style="color:green">UPDATE_IF</a> ARG=d <span style="background-color:yellow">__FILL__</span>
<a href="./_d_u_m_p_a_t_o_m_s.html" style="color:green">DUMPATOMS</a> ATOMS=rna,mg FILE=rna-select.gro
<a href="./_u_p_d_a_t_e__i_f.html" style="color:green">UPDATE_IF</a> ARG=d <span style="background-color:yellow">__FILL__</span> <span style="color:blue"># this command is required to close the UPDATE_IF above</span>

<span style="color:blue"># compute the center of the RNA molecule</span>
center: <a href="./_c_e_n_t_e_r.html" style="color:green">CENTER</a> ATOMS=rna

<span style="color:blue"># Wrap atoms correctly</span>
<a href="./_w_r_a_p_a_r_o_u_n_d.html" style="color:green">WRAPAROUND</a> ATOMS=mg AROUND=<span style="background-color:yellow">__FILL__</span>
<a href="./_w_r_a_p_a_r_o_u_n_d.html" style="color:green">WRAPAROUND</a> ATOMS=wat AROUND=center <span style="background-color:yellow">__FILL__</span> <span style="color:blue"># anything missing here?</span>

<span style="color:blue"># Dump the last trajectory</span>
<a href="./_d_u_m_p_a_t_o_m_s.html" style="color:green">DUMPATOMS</a> ATOMS=rna,wat,mg FILE=rna-wrap.gro
</pre><p>After you have prepared a proper <code>plumed.dat</code> file, you can use it with the following command </p><pre class="fragment">&gt; plumed driver --plumed plumed.dat --mf_xtc broken.xtc
</pre><p>Visualize the resulting trajectories using VMD. Since the <code>gro</code> files already contain atom names, you do not need to load the <code>pdb</code> file first. For instance, the first trajectory can be shown with</p>
<pre class="fragment">&gt; vmd rna-whole.gro
</pre><p> <span style="background-color:yellow">TODO: I should perhaps add reference plots</span></p>
<p> <details> <summary> <b> To learn more: Mastering WHOLEMOLECULES </b> </summary> <div class="hidden"> </p>
<p>If you just simulate a single solute molecule in water it is easy to understand how to pick the right options for <a class="el" href="_w_h_o_l_e_m_o_l_e_c_u_l_e_s.html">WHOLEMOLECULES</a>. However, if you have multiple molecules it can be rather tricky. In the example above, we used <a class="el" href="_w_h_o_l_e_m_o_l_e_c_u_l_e_s.html">WHOLEMOLECULES</a> on the RNA molecule which is actually a duplex, that is two separated chains. This was correct for the following reasons:</p><ul>
<li>the two chains are kept together by hydrogen bonds, and</li>
<li>the last atom of the first chain is always close to the first atom of the second chain.</li>
</ul>
<p>In case the two molecules can separate from each other this would be rather problematic.</p>
<p>We will now see what happens when using <a class="el" href="_w_h_o_l_e_m_o_l_e_c_u_l_e_s.html">WHOLEMOLECULES</a> on multiple molecules <em>incorrectly</em>.</p>
<h2><a class="anchor" id="trieste-1-ex-2b"></a>
Exercise 2b: Mistakes with WHOLEMOLECULES</h2>
<p>Prepare a PLUMED input file that makes all the water molecules whole. Use the following template </p><pre class="fragment">
<span style="color:blue"># First load information about the molecule.</span>
<a href="./_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <span style="background-color:yellow">__FILL__</span>

<span style="color:blue"># Define here the groups that you need</span>
rna: <a href="./_g_r_o_u_p.html" style="color:green">GROUP</a> ATOMS=<span style="background-color:yellow">__FILL__</span>
mg:  <a href="./_g_r_o_u_p.html" style="color:green">GROUP</a> ATOMS=<span style="background-color:yellow">__FILL__</span>
wat: <a href="./_g_r_o_u_p.html" style="color:green">GROUP</a> ATOMS=<span style="background-color:yellow">__FILL__</span>

<span style="color:blue"># Make RNA whole</span>
<a href="./_w_h_o_l_e_m_o_l_e_c_u_l_e_s.html" style="color:green">WHOLEMOLECULES</a> ENTITY0=rna

<span style="color:blue"># Now make water whole as if it was a single molecule</span>
<a href="./_w_h_o_l_e_m_o_l_e_c_u_l_e_s.html" style="color:green">WHOLEMOLECULES</a> ENTITY0=wat

<span style="color:blue"># And dump the resulting trajectory</span>
<a href="./_d_u_m_p_a_t_o_m_s.html" style="color:green">DUMPATOMS</a> ATOMS=rna,wat,mg FILE=wrong.gro
</pre><p>Now look at the resulting file with <code>vmd wrong.gro</code>. Can you understand which is the problem?</p>
<p>The important take-home message here is that when you want to reconstruct periodic boundary conditions correctly in systems with multiple molecules you should be careful and always verify with <a class="el" href="_d_u_m_p_a_t_o_m_s.html">DUMPATOMS</a> that the system is doing what you expect.</p>
<p> </div> </details> </p>
<p> <details> <summary> <b> To learn more: Mastering FIT_TO_TEMPLATE </b> </summary> <div class="hidden"> </p>
<p>In an exercise above we used <a class="el" href="_f_i_t__t_o__t_e_m_p_l_a_t_e.html">FIT_TO_TEMPLATE</a>. This action uses as a reference a PDB file which typically contains a subset of atoms (those that are fitted). However, when you apply <a class="el" href="_f_i_t__t_o__t_e_m_p_l_a_t_e.html">FIT_TO_TEMPLATE</a> with <code>TYPE=OPTIMAL</code>, the whole system is translated and rotated. The whole system here means all atoms plus the vectors defining the periodic box.</p>
<h2><a class="anchor" id="trieste-1-ex-2c"></a>
Exercise 2c: Mastering FIT_TO_TEMPLATE</h2>
<p>Check how the periodic box rotates when using <a class="el" href="_f_i_t__t_o__t_e_m_p_l_a_t_e.html">FIT_TO_TEMPLATE</a>. Use the following template </p><pre class="fragment">
<span style="color:blue"># First load information about the molecule.</span>
<a href="./_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> <span style="background-color:yellow">__FILL__</span>

<span style="color:blue"># Define here the groups that you need</span>
rna: <a href="./_g_r_o_u_p.html" style="color:green">GROUP</a> ATOMS=<span style="background-color:yellow">__FILL__</span>
mg:  <a href="./_g_r_o_u_p.html" style="color:green">GROUP</a> ATOMS=<span style="background-color:yellow">__FILL__</span>
wat: <a href="./_g_r_o_u_p.html" style="color:green">GROUP</a> ATOMS=<span style="background-color:yellow">__FILL__</span>

<span style="color:blue"># Make RNA whole</span>
<a href="./_w_h_o_l_e_m_o_l_e_c_u_l_e_s.html" style="color:green">WHOLEMOLECULES</a> ENTITY0=rna

<span style="color:blue"># Here's a compund variable with the box vectors</span>
<span style="color:blue"># computed before aligning RNA</span>
cell_before: <a href="./_c_e_l_l.html" style="color:green">CELL</a>

<span style="color:blue"># Now we align RNA</span>
<a href="./_f_i_t__t_o__t_e_m_p_l_a_t_e.html" style="color:green">FIT_TO_TEMPLATE</a> <span style="background-color:yellow">__FILL__</span> TYPE=OPTIMAL

<span style="color:blue"># Here's a compund variable with the box vectors</span>
<span style="color:blue"># computed after aligning RNA</span>
cell_after: <a href="./_c_e_l_l.html" style="color:green">CELL</a>
<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=cell_before.* FILE=CELL_BEFORE
<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=cell_after.* FILE=CELL_AFTER
</pre><p>You should obtains files like the ones reported below.</p>
<p><code>CELL_BEFORE</code> should be </p><pre class="fragment">#! FIELDS time cell_before.ax cell_before.ay cell_before.az cell_before.bx cell_before.by cell_before.bz cell_before.cx cell_before.cy cell_before.cz
 0.000000 4.533710 0.000000 0.000000 0.000000 4.533710 0.000000 2.266860 2.266860 3.205821
 1.000000 4.533710 0.000000 0.000000 0.000000 4.533710 0.000000 2.266860 2.266860 3.205821
 2.000000 4.533710 0.000000 0.000000 0.000000 4.533710 0.000000 2.266860 2.266860 3.205821
 3.000000 4.533710 0.000000 0.000000 0.000000 4.533710 0.000000 2.266860 2.266860 3.205821
 4.000000 4.533710 0.000000 0.000000 0.000000 4.533710 0.000000 2.266860 2.266860 3.205821
</pre><p><code>CELL_AFTER</code> should be </p><pre class="fragment">#! FIELDS time cell_after.ax cell_after.ay cell_after.az cell_after.bx cell_after.by cell_after.bz cell_after.cx cell_after.cy cell_after.cz
 0.000000 4.533710 -0.000059 -0.000008 0.000059 4.533710 -0.000172 2.266895 2.266952 3.205730
 1.000000 -0.396226 4.289476 -1.413481 -1.244340 1.260309 4.173460 2.249665 3.307132 2.134590
 2.000000 -3.016552 1.123968 -3.192434 -1.055123 -4.375593 -0.543533 -4.309790 -1.356178 0.375612
 3.000000 -4.083873 1.923282 -0.421306 0.339577 -0.267554 -4.513051 -3.243502 -2.069026 -2.398628
 4.000000 -4.020722 2.094622 -0.029688 -1.060483 -1.979827 3.938298 -1.263169 2.532008 3.542306
</pre><p>As you can see, the generating vectors of the periodic lattice <em>before</em> fitting are constant. On the other hand, <em>after</em> fitting these vectors change so as to keep RNA correctly aligned to its reference structure.</p>
<p>Later on you will learn how to add a bias potential on a give collective variable. In principle, you could also add a <a class="el" href="_r_e_s_t_r_a_i_n_t.html">RESTRAINT</a> ro the <code>cell_after.*</code> variables of the last example. This would allow you to force your molecule to a specific orientation.</p>
<p> </div> </details> </p>
<h2><a class="anchor" id="trieste-1-conclusions"></a>
Conclusions</h2>
<p>In summary, in this tutorial you should have learned how to use PLUMED to:</p><ul>
<li>Manipulate atomic coordinates.</li>
<li>Compute collective variables.</li>
</ul>
<p>All of this was done by just reading an already available trajectory. Notice that there are many alternative tools that could have been used to do the same exercise. Indeed, if you are familiar with other tools, it might be a good idea to also try them and compare the results. The special things of working with PLUMED are the following:</p><ul>
<li>PLUMED implements a vast library of useful collective variables. Browse the manual and search for ideas that are suitable for your system.</li>
<li>PLUMED has a simple and intuitive syntax to combine collective variables ending up in descriptors capable to characterize complex conformational changes.</li>
<li>And finally, the most special thing: any collective variable that can be computed within PLUMED can also be biased while you are running your MD simulation! You will learn more later about this topic.</li>
</ul>
<p>The last point is probably the main reason why PLUMED exists and what distinguishes it from other available software. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
