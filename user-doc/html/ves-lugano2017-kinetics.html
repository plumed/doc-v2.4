<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>PLUMED: MARVEL-VES tutorial (Lugano Feb 2017): Kinetics</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.4.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ves-lugano2017-kinetics.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MARVEL-VES tutorial (Lugano Feb 2017): Kinetics </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="ves-lugano2017-kinetics-aims"></a>
Aims</h1>
<p>The aim of this tutorial is to introduce the use of VES for obtaining kinetic information of activated processes. We will learn how to set up a biased simulation using a fixed flooding potential acting on a relevant slow degree of freedom. We can then rescale the accelerated MD time in a post-processing procedure.</p>
<h1><a class="anchor" id="ves-lugano2017-kinetics-lo"></a>
Learning Outcomes</h1>
<p>Once this tutorial is completed students will:</p>
<ul>
<li>Optimize a bias using VES with an energy cutoff to selectively fill low regions of the free energy surface.</li>
<li>Use the optimized bias to observe several rare event transitions</li>
<li>Post-process the accelerated trajectory to obtain an unbiased estimate of the transition rate</li>
<li>Compute the empirical cumulative distribution of first passage times and compare to a theoretical model.</li>
</ul>
<h1><a class="anchor" id="ves-lugano2017-kinetics-resources"></a>
Resources</h1>
<p>The <a href="tutorial-resources/ves-lugano2017-kinetics.tar.gz" download="ves-lugano2017-kinetics.tar.gz">tarball </a> for this project contains the following files:</p>
<ul>
<li>CH.airebo : Force field parameters for LAMMPS</li>
<li>input : LAMMPS input script</li>
<li>data.start : Starting configuration in LAMMPS format</li>
<li>plumed.dat : Example PLUMED file</li>
<li>time-reweighting.py : Python script for post-processing trajectory</li>
<li>TRAJECTORIES-1700K : A directory containing many trajectories for post processing</li>
<li>get-all-fpt.py : A python script to extract transition times from the trajectories</li>
<li>cdf.analysis.py : A python script to compute the cumulative probability distribution and perform KS test</li>
</ul>
<h1><a class="anchor" id="ves-lugano2017-kinetics-requirements"></a>
Requirements</h1>
<ul>
<li>python with numpy, scipy, and statsmodels</li>
<li>LAMMPS compiled with MANYBODY package</li>
<li>VMD for visualization</li>
</ul>
<h1><a class="anchor" id="ves-lugano2017-kinetics-Instructions"></a>
Instructions</h1>
<p><a class="anchor" id="stone-wales"></a></p><div class="image">
<img src="ves-lugano2017-kinetics_StoneWales.png" alt="ves-lugano2017-kinetics_StoneWales.png" width="500px"/>
<div class="caption">
Stone Wales Transformation</div></div>
<h2><a class="anchor" id="ves-lugano2017-kinetics-exercise-1A"></a>
Exercise 1A. Preliminary investigation using VES</h2>
<p>As an example of an activated process in materials science, we will work with the Stone-Wales transformation in a carbon nanotube. The <a href="tutorial-resources/ves-lugano2017-kinetics.tar.gz" download="ves-lugano2017-kinetics.tar.gz">tarball </a> for this project contains the inputs neccessary to run a simulation in LAMMPS for a 480 atom carbon nanotube. We use the AIREBO (Adaptive Intermolecular Reactive Empirical Bond Order) force field parameters which can approximately describe C-C bond breakage and formation at reasonable computational cost. For CVs we can use the coordination number in PLUMED to measure the number of covalent bonds among different groups of atoms. The transformation involves breaking two C-C bonds and forming two alternative C-C bonds.A definition of these CVs as well as the relevant C-C bonds are depicted in Figure <a class="el" href="ves-lugano2017-kinetics.html#stone-wales">stone-wales</a>. We prepare a PLUMED input file as follows.</p>
<pre class="fragment">
<span style="color:blue"># set distance units to angstrom, time to ps, and energy to eV</span>
<a href="./_u_n_i_t_s.html" style="color:green">UNITS</a> LENGTH=A TIME=ps ENERGY=eV

<span style="color:blue"># define two variables</span>
<a href="./_c_o_o_r_d_i_n_a_t_i_o_n.html" style="color:green">COORDINATION</a> GROUPA=229,219 GROUPB=238,207 R_0=1.8 NN=8 MM=16 PAIR LABEL=CV1
<a href="./_c_o_o_r_d_i_n_a_t_i_o_n.html" style="color:green">COORDINATION</a> GROUPA=229,219 GROUPB=207,238 R_0=1.8 NN=8 MM=16 PAIR LABEL=CV2

<span style="color:blue"># the difference between variables</span>
<a href="./_c_o_m_b_i_n_e.html" style="color:green">COMBINE</a> ARG=CV1,CV2 COEFFICIENTS=1,-1 POWERS=1,1 LABEL=d1 PERIODIC=NO
</pre><p>In the above, the first line sets the energy units. The second and third line define the two CVs for the C-C covalent bonds. (We have chosen atoms 238,207,229 and 219; however this choice is arbitrary and other atoms could equally well have been chosen.) Lastly, we define a simple approximate reaction coordinate given by the difference between CV1 and CV2 that we can use to monitor the transition.</p>
<p>Next we will use VES to drive the transformation at 1700 K. We bias the formation of bonds DB and AC shown in Figure <a class="el" href="ves-lugano2017-kinetics.html#stone-wales">stone-wales</a> using CV2 which changes from 0 to 2 during the transformation. (Although a more rigorous treatment would bias both CVs, for this tutorial we will simplify things and work in only one dimension). We choose a Chebyshev polynomial basis set up to order 36</p>
<pre class="fragment">
<span style="color:blue"># The basis set to use</span>
bf1: <a href="./_b_f__c_h_e_b_y_s_h_e_v.html" style="color:green">BF_CHEBYSHEV</a> ORDER=36 MINIMUM=0.0 MAXIMUM=2.0
</pre><p>and we tell PLUMED to use VES acting on CV2 with a free energy cutoff</p>
<pre class="fragment">
td_uniform: <a href="./_t_d__u_n_i_f_o_r_m.html" style="color:green">TD_UNIFORM</a>

<a href="./_v_e_s__l_i_n_e_a_r__e_x_p_a_n_s_i_o_n.html" style="color:green">VES_LINEAR_EXPANSION</a> ...
  ARG=CV2
  BASIS_FUNCTIONS=bf1
  LABEL=variational
  TEMP=1700
  BIAS_CUTOFF=15.0
  BIAS_CUTOFF_FERMI_LAMBDA=10.0
  TARGET_DISTRIBUTION=td_uniform
... VES_LINEAR_EXPANSION
</pre><p>Here we are biasing CV2 with the basis set defined above. The final two lines impose the cutoff at 15 eV. The cutoff is of the form</p>
<p class="formulaDsp">
\[ \frac{1}{1+e^{\lambda [F(s)-F_c]}} \]
</p>
<p> where \(\lambda\) (inverse energy units) controls how sharply the function goes to zero. Above we have set \(\lambda=10.0\) to ensure the cutoff goes sharply enough to zero.</p>
<p>The following input updates the VES bias every 200 steps, writing out the bias every 10 iterations. To enforce the energy cutoff we also need to update the target distribution which we do every 40 iterations with the TARGETDIST_STRIDE flag. </p><pre class="fragment">
<a href="./_o_p_t__a_v_e_r_a_g_e_d__s_g_d.html" style="color:green">OPT_AVERAGED_SGD</a> ...
  BIAS=variational
  STRIDE=200
  LABEL=var-S
  STEPSIZE=0.1
  COEFFS_FILE=coeffs.dat
  BIAS_OUTPUT=10
  TARGETDIST_STRIDE=40
  TARGETDIST_OUTPUT=40
  COEFFS_OUTPUT=1
... OPT_AVERAGED_SGD
</pre><p>Finally, we will stop the simulation when the transition occurs using the COMMITTOR in PLUMED</p>
<pre class="fragment">
<a href="./_c_o_m_m_i_t_t_o_r.html" style="color:green">COMMITTOR</a> ARG=d1 BASIN_LL1=-2.0 BASIN_UL1=-1.0 STRIDE=600
</pre><p>Run the simulation using LAMMPS</p>
<pre class="fragment">lmp_mpi &lt; input
</pre><p>and plot the last few bias output files (bias.variational.iter-n.data) using gnuplot. What is the difference between the maximum and minimum values of the bias obtained during the simulation? Is the cutoff value sufficient to cross the barrier? Is the cutoff value too large?</p>
<p>Figure <a class="el" href="ves-lugano2017-kinetics.html#Figure1A">Figure1A</a> shows an example bias potential after 90 iterations. Note that a cutoff of 15 eV is too large as the system transitions before the bias reaches the prescribed cutoff. From Figure <a class="el" href="ves-lugano2017-kinetics.html#Figure1A">Figure1A</a> we see a barrier height of approximately 7.3 eV.</p>
<p><a class="anchor" id="Figure1A"></a></p><div class="image">
<img src="ves-lugano2017-kinetics_figure-1A.png" alt="ves-lugano2017-kinetics_figure-1A.png"/>
<div class="caption">
Figure-1A</div></div>
<p>The output also produces an movie.xyz file which can be viewed in vmd. For better visualization, first change atom id from 1 to C by typing </p><pre class="fragment">sed "s/^1 /C /" movie.xyz &gt; newmovie.xyz
</pre><p> Then load the newmovie.xyz into vmd and choose Graphics &ndash;&gt; Representations and set Drawing Method to DynamicBonds. Create a second representation by clicking Create Rep and set the Drawing Method to VDW. Change the sphere scale to 0.3 and play the movie. You should observe the Stone-Wales transformation right before the end of the trajectory.</p>
<h2><a class="anchor" id="ves-lugano2017-kinetics-exercise-1B"></a>
Exercise 1B. Set up and run a VES bias imposing a cutoff</h2>
<p>In this exercise we will run a VES simulation to fill the FES only up to a certain cutoff. This will be the first step in order to obtain kinetic information from biased simulations. In the previous section, we observed that a cutoff of 15 eV is too strong for our purpose. Change the cutoff energy from 15.0 to 6.0 eV by setting</p>
<pre class="fragment">BIAS_CUTOFF=6.0
</pre><p>and rerun the simulation from Exercise 1A. [Note: In practice one can use multiple walkers during the optimization by adding the flag MULTIPLE_WALKERS]</p>
<p>Plot some of the bias files (bias.variational.iter-n.data) that are printed during the simulation using gnuplot. At the end of the simulation, you should be able to reproduce something like Figure <a class="el" href="ves-lugano2017-kinetics.html#Figure1B">Figure1B</a>. Is the bias converging? If so, how many iterations does it require to converge?</p>
<p>Figure <a class="el" href="ves-lugano2017-kinetics.html#Figure1B">Figure1B</a> shows the bias potential after 70,80, and 90 iteration steps. Note that the bias has reached the cutoff and goes to zero at around 1 Angstrom.</p>
<p><a class="anchor" id="Figure1B"></a></p><div class="image">
<img src="ves-lugano2017-kinetics_figure-1B.png" alt="ves-lugano2017-kinetics_figure-1B.png"/>
<div class="caption">
Figure-1B</div></div>
 <h2><a class="anchor" id="ves-lugano2017-kinetics-exercise-2"></a>
Exercise 2. Using a fixed bias as a flooding potential to obtain rates</h2>
<p>In this exercise we will use the bias obtained above as a static umbrella potential. We will set up and run a new trajectory to measure the first passage time of escape from the well.</p>
<p>We can extract the coefficients that we need from the final iteration in Exercise-1B above.</p>
<pre class="fragment">tail -n 47 coeffs.dat &gt; fixed-coeffs.dat
</pre><p>Now create a new directory from which you will run a new simulation and copy the necessary input files (including the fixed-coeffs.dat) into this directory. Modify the PLUMED file so that the optimized coefficients are read by the VES_LINEAR_EXPANSION</p>
<pre class="fragment">
td_uniform: <a href="./_t_d__u_n_i_f_o_r_m.html" style="color:green">TD_UNIFORM</a>

<a href="./_v_e_s__l_i_n_e_a_r__e_x_p_a_n_s_i_o_n.html" style="color:green">VES_LINEAR_EXPANSION</a> ...
  ARG=CV2
  BASIS_FUNCTIONS=bf1
  LABEL=variational
  TEMP=1700
  BIAS_CUTOFF=6.0
  BIAS_CUTOFF_FERMI_LAMBDA=10.0
  TARGET_DISTRIBUTION=td_uniform
  COEFFS=fixed-coeffs.dat
... VES_LINEAR_EXPANSION
</pre><p>The final line specifies the coefficients to be read from a file.</p>
<p>Make sure to remove the lines for the stochastic optimization (OPT_AVERAGED_SGD) as we no longer wish to update the bias.</p>
<p>We will also perform metadynamics with an infrequent deposition stride to ensure that the trajectory does not get stuck in any regions where the bias potential is not fully converged The following implements metadynamics on both CV1 and CV2 with a deposition stride of 4000 steps and a hill height of 0.15 eV.</p>
<pre class="fragment">
<a href="./_m_e_t_a_d.html" style="color:green">METAD</a> ...
   ARG=CV1,CV2
   SIGMA=0.2,0.2
   HEIGHT=0.15
   PACE=4000
   LABEL=metad
... METAD
</pre><p>Again we will use the COMMITTOR to stop the trajectory after the transition.</p>
<pre class="fragment">
<a href="./_c_o_m_m_i_t_t_o_r.html" style="color:green">COMMITTOR</a> ARG=d1 BASIN_LL1=-2.0 BASIN_UL1=-1.0
</pre><p>Now run a trajectory with the fixed bias. What is the time (biased) to escape? Plot the trajectory of the approximate reaction coordinate (column 4 in the COLVAR) in gnuplot. An example is shown in Figure <a class="el" href="ves-lugano2017-kinetics.html#Figure2">Figure2</a>.</p>
<p><a class="anchor" id="Figure2"></a></p><div class="image">
<img src="ves-lugano2017-kinetics_figure-2.png" alt="ves-lugano2017-kinetics_figure-2.png"/>
<div class="caption">
Figure-2</div></div>
<p> Also look at the metadynamics bias in the column labeled metad.bias. How does the magnitude compare to the bias from VES in column variational.bias?</p>
<p>The crossing time for a single event doesn't tell us much because we don't have any statistics on the transition events. To obtain the mean first passage time, we have to repeat the calculation many times. To generate statistically independent samples, we have to change the seed for the random velocities that are generated in the LAMMPS input file. In a new directory, copy the necessary files and edit the following line in the input file</p>
<pre class="fragment">velocity      all create 1700.  495920
</pre><p>Choose a different 6 digit random number and repeat Exercise 2. How does the escape time compare to what you obtained before? Repeat the procedure several times with different velocity seeds to get a distribution of first passage times. Make sure you launch each simulation from a separate directory and keep all COLVAR files as you will need them in the next section where we will analyze the transition times.</p>
<h2><a class="anchor" id="ves-lugano2017-kinetics-exercise-3"></a>
Exercise 3. Post processing to obtain unbiased estimate for the transition rate</h2>
<p>In the previous section you generated several trajectories with different first passage times. However, these times need to be re-weighted to correct for the bias potential. We can rescale the time according to the hyperdynamics formula</p>
<p class="formulaDsp">
\[ t^{*} = \Delta t_{MD} \sum_i^{n} e^{\beta V(s)} \]
</p>
<p>Note that we need to add the total bias at each step, coming from both the VES bias and metadynamics. The python script time-reweighting.py will read the COLVAR from Exercise 2 and print the final reweighted time (in seconds). Open the script to make sure you understand how it works.</p>
<p>Run the script using </p><pre class="fragment">python time-reweighting.py
</pre><p>Note that the output first passage time is converted to seconds. What is the acceleration factor of our biased simulation? (i.e. the ratio of biased to unbiased transition times) The script also produces a time-reweighted trajectory COLVAR-RW for a specified CV (here we choose the approximate reaction coordinate, d1). Plot the reweighted COLVAR-RW in gnuplot and compare the original vs. time-reweighted trajectories. In particular, what effect does rescaling have on the time step?</p>
<p>Rerun the script for each of the trajectories you have run with the fixed bias and compute the mean first passage time from your data. The Stone-Wales transformation at 1700 K is estimated in fullerene to be ~10 days. How does your average time compare to this value?</p>
<p>The distribution of first passage times for an activated processes typically follows an exponential distribution. Instead of directly making a histogram of the first passage times, we can look at the cumulative distribution function which maps a value x to the fraction of values less than or equal to x. Since we are computing the cumulative distribution from a data set, this is called the empirical cumulative distribution (ECDF). On the other hand, the theoretical cumulative distribution (CDF) of an exponentially distributed random process is</p>
<p class="formulaDsp">
\[ P(t) = 1-e^{-t/\tau} \]
</p>
<p>where \(\tau\) is the mean first passage time.</p>
<p>In order to calculate the ECDF we need many trajectories. Several COLVAR files are included in the TRAJECTORIES-1700K directory. The script get-all-fpt.py is a modified version of time-reweighting.py and will calculate the first passage time (fpt) from all the simulation data and will output the times to a file fpt.dat. Run the script from the TRAJECTORIES-1700K directory</p>
<pre class="fragment">python get-all-fpt.py
</pre><p>You should obtain the output file fpt.dat which has a list of all the times. You can append your own values you obtained from Exercise 2 to the end of the list to increase the number of data points.</p>
<p>The script cdf-analysis.py will compute the ECDF and fit the distribution to the theoretical CDF. The script uses the statsmodels Python module. Run the script with </p><pre class="fragment">python cdf-analyysis.py
</pre><p> from the same directory where the fpt.dat file is located. The script prints both the mean first passage time of the data as well as the fit parameter \(\tau\). How do these two values compare?</p>
<p><a class="anchor" id="Figure3"></a></p><div class="image">
<img src="ves-lugano2017-kinetics_figure-3.png" alt="ves-lugano2017-kinetics_figure-3.png"/>
<div class="caption">
Figure-3</div></div>
<p>Figure <a class="el" href="ves-lugano2017-kinetics.html#Figure3">Figure3</a> shows an example fit of the ECDF to the theoretical CDF for a Poisson process. To test the reliability of the fit, we can generate some data set according the theoretical CDF and perform a two-sample Kolmogorov-Smirnov (KS) test. The KS test provides the probability that the two sets of data are drawn from the same underlying distribution expressed in the so-called p-value. The null hypothesis is typically rejected for p-value &lt; 0.05. The script cdf-analysis.py also performs the KS test and prints the p-value. What is the p-value we obtain from your dataset of transition times? </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="_add_mod.html">Additional Modules</a></li><li class="navelem"><a class="el" href="_v_e_s.html">Variationally Enhanced Sampling (VES code)</a></li><li class="navelem"><a class="el" href="ves_tutorials.html">Tutorials</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
