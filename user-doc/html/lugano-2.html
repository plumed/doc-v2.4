<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>PLUMED: Lugano tutorial: Path CVs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.4.8</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('lugano-2.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Lugano tutorial: Path CVs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="lugano-2-aims"></a>
Aims</h1>
<p>Consider the two overlain protein structures that are shown in the figure below. <br />
Can you see the difference between these two structures? Can you think of a collective variable that could be used to study the substantial change in structure?</p>
<p><a class="anchor" id="lugano-2-cdk-fig"></a></p><div class="image">
<img src="belfast-2-cdk.png" alt="belfast-2-cdk.png"/>
<div class="caption">
CDK2 conformational change, PDB code 2C5X and 2C5Y.</div></div>
<p> Your answers to the questions posed above are hopefully: yes I can see the difference between the two structures - the upper loop is radically different in the two cases - and no I have absolutely no idea as to how to create a collective variable that might be used to study the change in structure.</p>
<p>These answers are interesting as they cut to the very heart of what is interesting about biomolecular systems. In fact this difficulty is one of the reasons why such systems are so widely studied. If you think for a moment about solid state systems any transition usually involves a substantial change in symmetry. <br />
Low energy configurations are usually high symmetry while higher energy configurations have a low symmetry. This makes it easy to design collective variables to study solid state transitions - you simply measure the degree of symmetry in the system (see <a class="el" href="belfast-10.html">Belfast tutorial: Steinhardt Parameters</a>). In biomolecular systems by constrast the symmetry does not change substantially during a folding transition. The unfolded state has a low symmetry but the folded state also has a low symmetry, which is part of the reason that it is so difficult to find the folded state from the amino acid sequence alone.</p>
<p>With all this in mind the purpose of this tutorial is to learn about how we can design collective variables that can be used to study transitions between different states of these low-symmetry systems. In particular, we are going to learn how we can design collective variables that describe how far we have progressed along some pathway between two configurations with relatively low symmetry. We will in most of this tutorial study how these coordinates work in a two-dimensional space as this will allow us to visualise what we are doing. Hopefully, however, you will be able to use what you learn from this tutorial to generalise these ideas so that you can use <a class="el" href="_p_a_t_h.html">PATH</a> and <a class="el" href="_p_c_a_v_a_r_s.html">PCAVARS</a> in higher-dimensional spaces. <br />
 </p>
<h1><a class="anchor" id="lugano-2-lo"></a>
Learning Outcomes</h1>
<p>Once this tutorial is completed students will:</p>
<ul>
<li>be able to explain what is computed by a <a class="el" href="_p_c_a_v_a_r_s.html">PCAVARS</a> coordinate and write down expressions for these quantities.</li>
<li>be able to write a PLUMED input file that calculates and prints a <a class="el" href="_p_c_a_v_a_r_s.html">PCAVARS</a> coordinate.</li>
<li>be able to write down an expression for the quantity contained in the \(s\) and \(z\) components of a <a class="el" href="_p_a_t_h.html">PATH</a> collective variable.</li>
<li>be able to write PLUMED input files that calculate <a class="el" href="_p_a_t_h.html">PATH</a> collective variables for a range of different metrics.</li>
<li>be able to measure the quality of a transition state by calculating the isocommittor.</li>
</ul>
<h1><a class="anchor" id="lugano-2-resources"></a>
Resources</h1>
<p>The <a href="tutorial-resources/lugano-2.tar.gz" download="lugano-2.tar.gz">tarball </a> for this project contains the following files:</p>
<ul>
<li>transformation.pdb : a trajectory that shows the transition between the C7ax and C7eq conformers of alanine dipeptide.</li>
<li>pca-reference.pdb : a file that gives the start and end points of the vector that connects the C7ax and C7eq conformers. This file contains the positions of the atoms in these two structures.</li>
<li>PCA-isocommittor : a directory containing the files required to run isocommitor simulations that monitor the values of \(\phi\), \(\psi\) and the PCA coordinate.</li>
<li>PATH-isocommittor : a directory containing the files required to run isocommitor simulations that monitor the values of the <a class="el" href="_p_a_t_h.html">PATH</a> collective variable \(S(X)\).</li>
<li>2CV-isocommittor : a directory containing the files required to run isocommitor simulations that monitor the values of the <a class="el" href="_p_a_t_h.html">PATH</a> collective variables \(S(X)\) and \(Z(X)\)</li>
</ul>
<h1><a class="anchor" id="lugano-2-instructions"></a>
Instructions</h1>
<p>In this tutorial we are going to be considering a conformational transition of alanine dipeptide. In particular we are going to be considering the transition between the two conformers of this molecule shown below:</p>
<p><a class="anchor" id="lugano-2-transition-fig"></a></p><div class="image">
<img src="belfast-2-transition.png" alt="belfast-2-transition.png"/>
<div class="caption">
Two metastable states of alanine dipeptide are characterized by their Ramachandran dihedral angles.</div></div>
<p> Alanine dipeptide is a rather well-studied biomolecule (in fact it is an overstudied molecule!). It is well known that you can understand the interconversion of the two conformers shown above by looking at the free energy surface as a function of the \(\phi\) and \(\psi\) ramachandran angles as shown below:</p>
<p><a class="anchor" id="lugano-2-rama-fig"></a></p><div class="image">
<img src="belfast-2-rama.png" alt="belfast-2-rama.png"/>
<div class="caption">
The Free energy landscape of alanine dipeptide in Ramachandran angles in the CHARMM27 force field.</div></div>
<p> In this tutorial we are not going to use these coordinates to study alanine dipeptide. Instead we are going to see if we can find a single collective variable that can distinguish between these two states.</p>
<h2><a class="anchor" id="lugano-2-pca1"></a>
PCA coordinates</h2>
<p>Consider the free energy surface shown in figure <a class="el" href="lugano-2.html#lugano-2-rama-fig">lugano-2-rama-fig</a>. It is clear that either the \(\phi\) ( \(x\)-axis) or the \(\psi\) ( \(y\)-axis) angle of the molecule can be used to distinguish between the two configurations shown in figure <a class="el" href="lugano-2.html#lugano-2-transition-fig">lugano-2-transition-fig</a>. Having said that, however, given the shape of landscape and the associated thermal fluctuations we would expect to see in the values of these angles during a typical simulation, it seems likely that \(\phi\) will do a better job at distinguishing between the two configurations. \(\psi\) would most likely be a bad coordinate as when the molecule is in the C7eq configuration the \(\psi\) angle can fluctuate to any value with only a very small energetic cost. If we only had information on how the \(\psi\) angle changed during a simulation we would thus struggle to distinguish a transition to the C7ax configuration from a thermal fluctuations. Unsurprinsgly then it has been shown that metadynamics simulations that use just the \(\phi\) angle as a collective variable can effectively drive the system from the C7ax configuration to the C7eq configuration. We will not repeat these calculations here but will instead use driver to determine how the values of \(\phi\) and \(\psi\) change as we move between along the transition path that connects the C7ax configuration to the C7eq state.</p>
<pre class="fragment">t1: TORSION ATOMS=2,4,6,9
t2: TORSION ATOMS=4,6,9,11
PRINT ARG=t1,t2 FILE=colvar
</pre><p>Lets run this now on trajectory that describes the transition from the C7ax configuration to the C7eq configuration. To run this calculation copy the input file above into a file called plumed.dat and run the command below:</p>
<pre class="fragment">plumed driver --mf_pdb transformation.pdb
</pre><p>Try plotting each of the two torsional angles in this file against time in order to get an idea of how good a job each one of these coordinates at distinguishing between the various configurations along the pathway connecting the C7ax and C7eq configurations. What you will see is that in both cases the CV does not increase/decrease monotonically as the transition progresses.</p>
<p>We can perhaps come up with a better coordinate that incorporates changes in both \(\phi\) and \(\psi\) by using the coordinate illustrated in the figure below.</p>
<p><a class="anchor" id="pca-figure"></a></p><div class="image">
<img src="lugano-2-pca-coordinates.png" alt="lugano-2-pca-coordinates.png"/>
<div class="caption">
An illustration showing how PCAVARS coorditates work. The vector connecting some reference state to any state the system is in can be in (purple and orange points) can be projected onto the vector connecting the two states of interest (black arrow) by using the dot product of the vectors shown here.</div></div>
<p> We can even use PLUMED to calculate this coordinate by using the input shown below:</p>
<pre class="fragment">t1: TORSION ATOMS=2,4,6,9
t2: TORSION ATOMS=4,6,9,11
tc: COMBINE ARG=t1,t2 COEFFICIENTS=2.621915,-2.408714 PERIODIC=NO 
PRINT ARG=t1,t2,tc FILE=colvar
</pre><p>Try calculating the values of the above collective variables for each of the configurations in the transformation.pdb file by using the command that was given earlier.</p>
<p>Notice that what we are using here are some well known results on the dot product of two vectors here. Essentially if the values of the ramachandran angles in the C7eq configuration are \((\phi_1,\psi_1)\) and the ramachandran angles in the C7ax configuration are \((\phi_2,\psi_2)\). If our instantaneous configuration is \((\phi_3,\psi_3)\) we can thus calculate the following projection on the vector connecting the C7eq state to the C7ax state:</p>
<p class="formulaDsp">
\[ s = (\phi_2 - \phi_1).(\phi_3 - \phi_1) + (\psi_2 - \psi_1).(\psi_3 - \psi_1) \]
</p>
<p>which is just the dot product between the vector connecting the point \((\phi_1,\psi_1)\) to \((\phi_2,\psi_2)\) and the vector connecting the point \((\phi_1,\psi_1)\) to \((\phi_3,\psi_3)\). If we call these two vectors \(\mathbf{v}_1\) and \(\mathbf{v}_2\) we can write this dot product as:</p>
<p class="formulaDsp">
\[ \mathbf{v}_1 \cdot \mathbf{v}_2 = | \mathbf{v}_1 | | \mathbf{v}_2 | cos( \alpha ) \]
</p>
<p>where \(| \mathbf{v}_1 |\) and \(| \mathbf{v}_2 |\) are the magnitudes of our two vectors and where \(\alpha\) is the angle between the two of them. Elementary trignometry thus tells us that if \(\mathbf{v}_1\) is a unit vector (i.e. if it has magnitude 1) the dot product is thus equal to the projection of the vector \(\mathbf{v}_2\) on \(\mathbf{v}_2\) as shown in figure <a class="el" href="lugano-2.html#pca-figure">pca-figure</a>.</p>
<p>This is an useful idea. In fact it is the basis of the <a class="el" href="_p_c_a_v_a_r_s.html">PCAVARS</a> collective variable that is implemented in PLUMED so we can (almost) calculate the projection on this vector by using the input shown below:</p>
<pre class="fragment">t1: TORSION ATOMS=2,4,6,9
t2: TORSION ATOMS=4,6,9,11
pca: PCAVARS REFERENCE=angle-pca-reference.pdb TYPE=EUCLIDEAN 
PRINT ARG=t1,t2,pca.* FILE=colvar 
</pre><p>We cannot, however, do this in practise (we also shouldn't really use the previous input either) as the <a class="el" href="_t_o_r_s_i_o_n.html">TORSION</a> angles that we use to define our vectors here are periodic. In this next section we will thus look at how we can avoid this problem of periodicity by working in a higher dimensional space.</p>
<h2><a class="anchor" id="lugano-2-metric1"></a>
PCA with the RMSD metric</h2>
<p>In the previous section I showed how we can use the projection of a displacement on a vector as a collective variable. I demonstrated this in a two dimensional space as this makes it easy to visualize the vectors involved. We are not forced to work with two dimensional vectors, however. We can instead find the vector that connects the C7eq and C7ax states in some higher dimensional space and project our current coordinate on that particular vector. In fact we can even define this vector in the space of the coordinates of the atoms. In other words, if the 3 \(N\) coordinate of atomic positions is \(\mathbf{x}^{(1)}\) for the C7eq configuration and \(\mathbf{x}^{(2)}\) for the C7ax configuration and if the instanenous configuration of the atoms is \(\mathbf{x}^{(3)}\) we can use the following as a CV: </p><p class="formulaDsp">
\[ s = \sum_{i=1}^{3N} (x^{(2)}_i - x^{(1)}_i ) (x^{(3)}_i - x^{(1)}_i ) \]
</p>
<p> where the sum here runs over the \(3N\)-dimensional vector that defines the positions of the \(N\) atoms in the system. This is what (in a manner of speaking - I will return to this point momentarily) is calculated by this PLUMED input:</p>
<pre class="fragment">t1: TORSION ATOMS=2,4,6,9
t2: TORSION ATOMS=4,6,9,11
pca: PCAVARS REFERENCE=pca-reference.pdb TYPE=OPTIMAL
PRINT ARG=t1,t2,pca.* FILE=colvar
</pre><p>Use this input to analyse the set of configurations that are in the transformation.pdb file.</p>
<p>Let's now look further at the caveat that I alluded to before we ran the calculations. I stated that we are only calculating: </p><p class="formulaDsp">
\[ s = \sum_{i=1}^{3N} (x^{(2)}_i - x^{(1)}_i ) (x^{(3)}_i - x^{(1)}_i ) \]
</p>
<p> in a manner of speaking. The point is that we would not want to calculate exactly this quantity because the vectors of displacements that are calculated in this way includes both rotational and translational motion. This is a problem as the majority of the change in moving from the C7ax configuration shown in figure <a class="el" href="lugano-2.html#lugano-2-transition-fig">lugano-2-transition-fig</a> to the C7eq configuration shown in figure <a class="el" href="lugano-2.html#lugano-2-transition-fig">lugano-2-transition-fig</a> comes from the translation of all the atoms. To put this another way if I had, in figure <a class="el" href="lugano-2.html#lugano-2-transition-fig">lugano-2-transition-fig</a>, shown two images of the C7ax configuration side by side the displacement in the positions of the atoms in those two structures would be similar to the displacement of the atoms in <a class="el" href="lugano-2.html#lugano-2-transition-fig">lugano-2-transition-fig</a> as as the majority of the displacement in the vector of atomic positions comes about because I have translated all the atoms in the molecule rightwards by a fixed amount. I can, however, remove these translational displacements from consideration when calculating these vectors. In addition, I can also remove any displacements due rotation in the frame of reference of the molecule. If you are interested in how this is done in practise you can read about it on the manual page about the <a class="el" href="_r_m_s_d.html">RMSD</a> collective variable. For what concerns us here, however, all we need to know is that when we use the OPTIMAL metric we are calculating a vector which tells us how far the atoms have been displaced in moving from structure A to structure B in a way that excludes any displacements due to translation of the center of mass of the molecule or any displacements that occur due to rotation of the cartesian frame.</p>
<h2><a class="anchor" id="lugano-2-iso"></a>
The isocommitor surface</h2>
<p>In the previous sections I have been rather loose when talking about better and worse collective variables in that I have not been clear in my distinction between what makes a collective variable good and what makes a collective variable bad. In this section I thus want to discuss one method that we can use to judge the quality of a collective variable. This method involves calculating the so called isocommitor. The essential notion behind this techinique is that there will be a saddle point between the two states of interest (the C7ax and C7eq configurations in our alanine dipeptide example). If the free energy is plotted as a function of a good collective variable the location of this dividing surface - the saddle point - will appear as a maximum.</p>
<p>Lets suppose that we now start a simulation with the system balanced precariously on this maximum. The system will, very-rapidly, fall off the maximum and move towards either the left or the right basin. Furthermore, if this maximum provides a good representation of the location of the transition state ensemble - in other words if the position of maximum in the low-dimensional free energy surface tells us something about the structure in the transition state ensemble - then 50% of trajectories started from this point will fall to the left and 50% will fall to the right. If by contrast the maximum in the free energy surface does not represent the location of the transition state well then there will be an imbalance between the number of trajectories that move rightwards and the number that move leftwards.</p>
<p>We can think of this business of the isocomittor one further way, however. If in the vicinity of the transition state between the two basins the collective variable is perpendicular to the surface separating these two states half of the trajectories that start from this configuration will move to the left in CV space while the other half will move to the right. If the dividing surface and the CV are not perpendicular in the vicinity of the transition state, however, there will be an imbalance between the number of trajectories that move rightwards and the number of trajectories that move leftwards. We can thus determine the goodness of a collective variable by shooting trajectories from what we believe is the transition state and examining the number of trajectories that move into the left and right basins.</p>
<p>Lets make all this a bit more concrete by looking at how we might calculate isocomittors by using some of the collective variables we have introduced in this exercise. You will need to go into the directory in the tar ball that you downloaded that is called PCA-isocommittor. In this directory you will find a number of files that will serve as input to gromacs 5 and PLUMED. You thus need to ensure that you have an installed version of gromacs 5 patched with PLUMED on your computer in order to perform this exercise. In addition to these input files you will find a bash script called script.sh, which we are going to use in order to set of a large number of molecular dynamics simualtions. If you open script.sh you will find the following lines near the top:</p>
<pre class="fragment">GROMACS_BIN=/Users/gareth/MD_code/gromacs-5.1.1/build/bin
GROMACS=$GROMACS_BIN/gmx
source $GROMACS_BIN/GMXRC.bash
</pre><p> <br />
 These will need to be adjusted so that the GROMACS_BIN variable points at the bin directory of the gromacs build on your computer. Once you have made this modification though you can run the calculation by issuing the following command in the PCA-isocommittor directory:</p>
<pre class="fragment">./script.sh
</pre><p>This command submits 50 molecular dynamics simulations that all start from a configuration that lies between the C7eq and C7ax configurations of alanine dipeptide. In addition, this command also generates some scripts that allow us to visualise how the \(\phi\), \(\psi\) and PCA coordinates that we introduced in the previous sections change duing each of these 50 simulations. If you load gnuplot and issue the command:</p>
<pre class="fragment">load "script_psi.gplt"
</pre><p>you see how \(\psi\) changes during the course of the 50 simulations. Similarly the gnuplot command:</p>
<pre class="fragment">load "script_phi.gplt"
</pre><p>will show how how \(\phi\) changes during the course of the 50 simulations and:</p>
<pre class="fragment">load "script_pca.gplt"
</pre><p>gives you the information on the pca coordinates. If you look at the \(\psi\) and pca data first you can see clearly that it is very difficult to distinguish the configurations that moved to the C7eq basin from the trajectories that moved to the C7ax basin. By contrast if you look at the data on the \(\phi\) angles you can indeed use these plots to distinguish the trajectories that moved to C7eq from the trajectories that moved to C7ax. It is abundantly clear, however, that the number of trajectories that moved to C7eq is not equal to the number of trajectories that moved to C7ax. This CV, therefore, is not capturing the transition state ensemble.</p>
<p>One thing you will have seen from these examples is that the <a class="el" href="_p_c_a_v_a_r_s.html">PCAVARS</a> coordinate that were introduced in the previous sections provides an extremely poor model for the transition state ensemble. The value of the isocommittor at the maximum for both of these variables is not at all close to 50%. In fact the CV is not even particularly good at capturing the difference between these two states. If you look at the free energy surface shown below it is perhaps clear why.</p>
<p><a class="anchor" id="ala-tstate"></a></p><div class="image">
<img src="lugano-2-trans-state.png" alt="lugano-2-trans-state.png"/>
<div class="caption">
The PCAVARS coordinate and the transition state are highlighted on this figure. As you can see the coordinate does not pass through the transition state</div></div>
<p>You can see the location of the saddle point between these two states in this surface and it is very clear that the vector connecting the C7eq state to the C7ax state does not pass through this point. In fact it would be extremely fortuitous if a vector connecting an initial state and a final state also passed through the intermediate transition state between them. We can, after all, define the equation of straight line (a vector) if we are given only two points on it. In the next section we are thus going to see how we can resolve this problem by introducing a non-linear (or curvilinear) coordinate.</p>
<h2><a class="anchor" id="lugano-2-pathcvs"></a>
Path collective variables</h2>
<p>Consider the black path that connects the C7ax and C7eq states in the free energy shown below:</p>
<p><a class="anchor" id="lugano-2-good-bad-path-fig"></a></p><div class="image">
<img src="belfast-2-good-bad-path.png" alt="belfast-2-good-bad-path.png"/>
<div class="caption">
Examples of good and bad paths: the black path follows the minimum free energy path connecting the two metastable states, while the red path connects the two states directly via a linear path that passes through high energy</div></div>
<p> This black pathways appears to be the "perfect" coordinate for modelling this conformational transition as it passes along the lowest energy pathway that connects the two states and because it thus passes over the lowest saddle point that lies between them. We can calculate such a coordinate with PLUMED by using the input file below (I will return to the mathematical details of how this works momentarily)</p>
<pre class="fragment">path: PATH REFERENCE=path-reference.pdb TYPE=OPTIMAL LAMBDA=15100.
PRINT ARG=* STRIDE=2 FILE=colvar FMT=%12.8f
</pre><p>Lets thus use this input and run an isocomittor analsysis using the location of the maximum in this coordinate as the start point for all our trajectories. Everything you need to do this analysis is in the PATH-isocommittor directory. Once again you will find that there is a script.sh bash script inside this directory, which, as in the previous section, you can use to run a large number of molecular dynamics simulation. Furhthermore, similarly to the last section you will need to begin this exercise by modifying the location of path to gromacs within this script. Once you have made this modification submit your molecular dynamics jobs by issuing the command:</p>
<pre class="fragment">./script.sh
</pre><p>You can then plot the data output using gnuplot and the command:</p>
<pre class="fragment">load "script_path.gplt"
</pre><p>Unlike what we saw for the <a class="el" href="_p_c_a_v_a_r_s.html">PCAVARS</a> variables in the previous section we find that it is easy to use these <a class="el" href="_p_a_t_h.html">PATH</a> variables to distinguish those configurations that moved to C7ax from those that moved to C7eq. Having said that, however, we still have a large imbalance between the number of trajectories that move rightwards and the number that move leftwards. We are thus still a long way from unambiguously identifying the location of the transition state ensemble for this system.</p>
<h2><a class="anchor" id="lugano-2-pathcvs2"></a>
The mathematics of path collective variables</h2>
<p><br />
 Let's now take a moment to discuss the mathematics of these coordinates, which is not so complicated if we think about what they do through an analogy. Suppose that you were giving your friend instructions as to how to get to your house and lets suppose these instructions read something like this:</p>
<ol type="1">
<li>Take the <b> M1 motorway </b> and get off <b> at junction 5 </b></li>
<li>At <b> the roundabout </b> you need to take <b> the third exit </b> towards <b> Crumlin </b></li>
<li>Follow the road as far as the <b> farmers arms </b> then take the <b> next left </b></li>
<li><p class="startli">The house is <b> on the corner by the garage. </b> <br />
 If you think about these instructions in the abstract what you have is a set of way markers (the item I have put in bold) in a particular order. The list of way markers is important as is the order they appear in in the instructions so we incorporate both these items in the <a class="el" href="_p_a_t_h.html">PATH</a> coordinates that we have just used to study the transition between the transition between C7eq and C7ax. In these coordinates the way markers are a set of interesting points in a high dimensional space. In other words, these are like the configurations of C7eq and C7ax that we used in the previous sections when talking about <a class="el" href="_p_c_a_v_a_r_s.html">PCAVARS</a>. Each of these configurations lies along the path connecting C7eq and C7ax and, as in the directions example above, one must pass them in a particular order in order to pass between these two conformations. The final CV that we have used above is thus:</p>
<p class="formulaDsp">
\[ S(X)=\frac{\sum_{i=1}^{N} i\ \exp^{-\lambda \vert X-X_i \vert }}{ \sum_{i=1}^{N} \exp^{-\lambda \vert X-X_i \vert } } \]
</p>
</li>
</ol>
<p>In this expression \(\vert X-X_i \vert\) is the distance between the instaneous coordinate of the system, \(X\), in the high-dimensional space and \(X_i\) is the coordinate of the \(i\)th waymark in the path. The largest exponential in the sum that appears in the numerator and the denominator will thus be the one that corresponds to the point that is closest to where the system currently lies. In other words, \(S(X)\), measures the position on a (curvilinear) path that connects two states of interest as shown in red in the figure below:</p>
<p><a class="anchor" id="lugano-2-ab-sz-fig"></a></p><div class="image">
<img src="belfast-2-ab-sz.png" alt="belfast-2-ab-sz.png"/>
<div class="caption">
The S variable can be thought as the length of the red segment, while the Z variable is the length of the green one.</div></div>
<h2><a class="anchor" id="lugano-2-pathz"></a>
The Z(X) collective variable</h2>
<p>You may reasonably ask what the purpose these <a class="el" href="_p_a_t_h.html">PATH</a> collective variables variables serve given that in this case they seem to do no better than \(\phi\) when it comes to the tests we have performed on calculating the isocomittor. To answer this question we are going to run one final set of isocommittor simulations. The input for these calculations are in the directory called 2CV-isocommitor. Once again you will find that there is a script.sh bash script inside this directory, which, as in the previous section, you can use to run a large number of molecular dynamics simulation. Furhthermore, similarly to the last section you will need to begin this exercise by modifying the location of path to gromacs within this script. Once you have made this modification submit your molecular dynamics jobs by issuing the command:</p>
<pre class="fragment">./script.sh
</pre><p>You can then plot the data output using gnuplot and the commands:</p>
<pre class="fragment">load "script_pca.gplt"
</pre><p>and</p>
<pre class="fragment">load "script_path.gplt"
</pre><p>What is plotted by these commands is slightly different from what was plotted in the previous exercises where we calculated the isocommittor. <br />
Instead of plotting the value of the CV against simulation time the above commands plot the values that 2CVs take during the simulation. The script called script_path.gplt plots the value of the \(S(X)\) collective variable on the x-axis and the value of the following quantity on the y-axis:</p>
<p class="formulaDsp">
\[ Z(X)=-\frac{1}{\lambda}\log (\sum_{i=1}^{N} \ \exp^{-\lambda \vert X-X_i \vert }) \]
</p>
<p>What this quantity measures is shown in green in the figure <a class="el" href="lugano-2.html#lugano-2-ab-sz-fig">lugano-2-ab-sz-fig</a>. Essentially it measures the distance between the instantaneous configuration the system finds itself in and the path that is marked out using the waymarkers. If you plot the data using script_path.gplt what you thus see is that the system never moves very far from the path that is defined using the <a class="el" href="_p_a_t_h.html">PATH</a> command. In short the system follows this path from the transition state back to either the C7eq or C7ax configuration.</p>
<p>We can calculate a quantity similar to \(Z(X)\) for the <a class="el" href="_p_c_a_v_a_r_s.html">PCAVARS</a> collective variables. Furthermore, when we plot the data we have generated using this exercise using script_pca.gplt the value this quantity takes is shown plotted against the instantaneous value of the <a class="el" href="_p_c_a_v_a_r_s.html">PCAVARS</a> collective variable. If you compare this graph with what was obtained when you plotted the output from <a class="el" href="_p_a_t_h.html">PATH</a> above you see that the system has moved very far from the <a class="el" href="_p_c_a_v_a_r_s.html">PCAVARS</a> coordinate.</p>
<p>This exercise illustrates the strength of these <a class="el" href="_p_a_t_h.html">PATH</a> collective variables. We can use a <a class="el" href="_p_a_t_h.html">PATH</a> to monitor how a large number of coordinates change during a chemical transition. Furthermore, we can use \(Z(X)\) to measure how much real trajectories deviate from our <a class="el" href="_p_a_t_h.html">PATH</a> and thus have a quantitative measure of how well our <a class="el" href="_p_a_t_h.html">PATH</a> represents the true transition mechanism. Compare this with using a single CV such as \(\phi\). When use use a single CV we map the high-dimensional data from the traejctory into a lower dimensional space. We thus lose some information on what occurs during the transition. <br />
To be clear we also loose information on the what occurs during the transition when we use <a class="el" href="_p_a_t_h.html">PATH</a> as any mapping into a lower dimensional space deletes information. In the <a class="el" href="_p_a_t_h.html">PATH</a> case, however, we can use the value of \(Z(X)\) to measure how much data has been lost in mapping the trajectory onto \(S(X)\).</p>
<p>These two coordinates, \(S(X)\) and \(Z(X)\), are very flexible. They are thus been used widely in the literature on modelling conformational changes of biomolecules. A part of this flexibility comes because one can use any set of waymarkers to define the <a class="el" href="_p_a_t_h.html">PATH</a>. Another flexibility comes, however, when you recognise that you can also change the way in which the distance, \( \vert X- X_i \vert \), is calculated in the two formulas above. For example this distance can be calculated using the <a class="el" href="_r_m_s_d.html">RMSD</a> distance or it can be calculated by mesauring the sum of the squares of a set of displacements in collective variable values (see <a class="el" href="_t_a_r_g_e_t.html">TARGET</a>). Changing the manner in which the distance between path way points is calculated thus provides a way to control the level of detail that is incorporated in the description of the reaction <a class="el" href="_p_a_t_h.html">PATH</a>.</p>
<h2><a class="anchor" id="lugano-2-pathcv-find"></a>
Optimising path collective variables</h2>
<p>Hopefully the previous sections have allowed you to understand how <a class="el" href="_p_a_t_h.html">PATH</a> collective variables work and the sorts of problems they might be used to solve. If you have one of these problems to solve the next reasonable question to ask is: how to collect the set of reference frames that serve as the waymarkers on your <a class="el" href="_p_a_t_h.html">PATH</a>. Unfortunately, there is no single answer to this question. Different researchers have used different methods including using packages that morph one protein structure into another, using information from prior molecular dynamics or ehnanced sampling calculations and even using <a class="el" href="_p_a_t_h.html">PATH</a> collective variables that change adaptively as the simulation progresses. Ultimately, you will need to find the best method for solving your particular problem. Having said that, however, there is some general guidance on setting up <a class="el" href="_p_a_t_h.html">PATH</a> collective variable and it is this that we will focus on in this section. The first thing that you will need to double check is the set of spacings between all the frames in your <a class="el" href="_p_a_t_h.html">PATH</a>. Lets suppose that your <a class="el" href="_p_a_t_h.html">PATH</a> has \(N\) of these way markers upon it you will need to calculate is the \(N \times N\) matrix of distances between way markers. That is to say you will have to calculate the distance \(\vert X_j - X_i \vert\) between each pair of frames. The values of the distance in this matrix for a good <a class="el" href="_p_a_t_h.html">PATH</a> are shown in the figure below:</p>
<p><a class="anchor" id="lugano-2-good-matrix-fig"></a></p><div class="image">
<img src="belfast-2-good-matrix.png" alt="belfast-2-good-matrix.png"/>
<div class="caption">
A good distance matrix for path variables has the gullwing shape shape shown here.</div></div>
<p>For contrast the values of the distances in this matrix for a bad <a class="el" href="_p_a_t_h.html">PATH</a> are shown in the figure below:</p>
<p><a class="anchor" id="lugano-2-bad-matrix-fig"></a></p><div class="image">
<img src="belfast-2-bad-matrix.png" alt="belfast-2-bad-matrix.png"/>
<div class="caption">
A bad distance matrix for path variables is rather irregular.</div></div>
<p> If the distance matrix looks like the second of the two figures shown above this is indicates that the frames in the <a class="el" href="_p_a_t_h.html">PATH</a> that have been chosen are not particularly effective. Lets suppose that we have a <a class="el" href="_p_a_t_h.html">PATH</a> with four way markers upon it. In order for the \(S(x)\) CV that was defined earlier to work well frame number 3 must be further from frame number 1 than frame number 2. Similarly frame number 4 must be still further from frame number 1 than frame number 3. This is what the gullwing shape in <a class="el" href="lugano-2.html#lugano-2-good-matrix-fig">lugano-2-good-matrix-fig</a> is telling us. The order of the frames in the rows and columns of the matrix is the same as the order that they are run through in the sums in the equation for \(S(X)\). The shape of the surface in this figure shows that the distance between frames \(i\) and \(j\) increases monotonically as the magnitude of the difference between \(i\) and \(j\) is increased, which is what is required.</p>
<p>A second important requirement of a good <a class="el" href="_p_a_t_h.html">PATH</a> is shown in the figure below: <br />
 <a class="anchor" id="lugano-2-good-vs-bad-fig"></a></p><div class="image">
<img src="belfast-2-good-vs-bad.png" alt="belfast-2-good-vs-bad.png"/>
<div class="caption">
Comparison between the distances between neighbouring frames on the PATH. A good PATH will have a set of frames that are all approximately equally spaced along it.</div></div>
<p> A good <a class="el" href="_p_a_t_h.html">PATH</a> has an approximately equal spacing between the neighbouring frames along it. In other words, the distance between frame 1 and frame 2 is approximately equal to the distance between frame 2 and frame 3 as shown above. When this condition is satisfied a good criterion for selecting a suitable \(\lambda\) parameter to use is:</p>
<p class="formulaDsp">
\[ \lambda=\frac{2.3 (N-1) }{\sum_{i=1}^{N-1} \vert X_i-X_{i+1} \vert } \]
</p>
<h1><a class="anchor" id="lugano-2-conc"></a>
Conclusions and further work</h1>
<p>If you have worked through all of this tutorial make sure that you have understood it by ensuring that you understand what the list of learning outcomes in section <a class="el" href="lugano-2.html#lugano-2-lo">Learning Outcomes</a> means and that you can use PLUMED to perform all these tasks. You might then want to read the original paper on the <a class="el" href="_p_a_t_h.html">PATH</a> collective variable method as well as a few other articles in which these coordinates have been used to analyse simulations and to accelerate sampling.</p>
<ul>
<li>Davide Branduardi and Francesco Luigi Gervasio and Michele Parrinello <a href="http://aip.scitation.org/doi/10.1063/1.2432340">From A to B in free energy space </a> J. Chem. Phys., 126, 054103 (2007)</li>
</ul>
<p>If you are interested in learning more about isocommitor surfaces and the transition state ensemble you should read up on the transition path sampling method. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
